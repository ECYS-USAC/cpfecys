{{extend 'template.html'}}
<div class="row-fluid">
  	<div class="well span12">
  		<a onclick="window.history.back()" class="btn" ><i class="icon-arrow-left"></i> Back</a>
		<table class="table table-bordered">
			<thead>
                <tr>
                    <th colspan="10"></th>
                    <th colspan="2">{{=T('Actions')}}</th>
                </tr>
				<tr>
					<th>
						{{=T('Project')}}
					</th>
					<th>
						{{=T('Created')}}
					</th>
					<th>
						{{=T('School id')}}
					</th>
					<th>
						{{=T('User')}}
					</th>
					<th>
						{{=T('Restriction')}}
					</th>
					<th>
						{{=T('Score')}}
					</th>
					<th>
						{{=T('Status')}}
					</th>
					<th>
                        {{=T('Report Summary')}}
					</th>
					<th>
						{{=T('Started')}}
					</th>
					<th>
						{{=T('Ends')}}
					</th>
                    <th>
                        {{=T('DTT Approval')}}
                    </th>
					<th>
						{{=T('Report')}}
                    </th>
				</tr>
			</thead>
			<tbody>
				{{for report in reports:}}
				{{hours_left = 400}}
				{{hours_left = hours_left - (report.hours or 0)}}
				<tr>
					<td>
						{{=report.assignation.project.name}}	
					</td>
					<td>
						{{=report.created}}	
					</td>
					<td>
						{{=report.assignation.assigned_user.username}}	
					</td>
					<td>
						{{=report.assignation.assigned_user.first_name}}
						{{=report.assignation.assigned_user.last_name}}
					</td>
					<td>
						{{=report.report_restriction.name}}	
					</td>
					<td>
						{{=report.score or 0}}	
					</td>
					<td>
						{{=T(report.status.name)}}
					</td>
					<td>
                        <b>{{=T('Activity logs')}}:</b>
						{{=count_log_entries(report)[0]['COUNT(log_entry.id)']}}
                        <br />
                        <b>{{=T('Metric logs')}}:</b>
                        {{=count_metrics_report(report)[0]['COUNT(log_metrics.id)']}}
                        <br />
                        <b>{{=T('Hours')}}:</b>
                        {{=report.hours or 0}}
                        <br />
                        <b>{{=T('Pending Hours')}}:</b>
                        {{=hours_left}}
                        <br />
                        <b>{{=T('Anomalies')}}:</b>
                        {{=count_anomalies(report)[0]['COUNT(log_entry.id)']}}
					</td>
					<td>
						{{=report.assignation.period.yearp}} - {{=T(report.assignation.period.period.name)}}
					</td>
					<td>
						{{=calculate_ending_date(report)}}
					</td>
                    <td>
                        {{if report.dtt_approval is None:}}
                        <span class="label">
                            {{=T('Pending Approval')}}
                        </span>
                        {{elif report.dtt_approval is True:}}
                        <span class="label label-success">
                            {{=T('Approved')}}
                        </span>
                        {{else:}}
                        <span class="label label-warning">
                            {{=T('Failed')}}
                        </span>
                        {{pass}}
                        <a class="btn btn-success"
                           href="{{=URL('admin','dtt_approval', vars=dict(report=report.id, approve=True))}}">
		                <span class="icon-check"></span>
		                </a>
                        <a class="btn btn-danger"
                           href="{{=URL('admin','dtt_approval', vars=dict(report=report.id, approve=False))}}">
		                <span class="icon-remove"></span>
		                </a>
                        <a class="btn"
                           href="{{=URL('admin','dtt_approval', vars=dict(report=report.id))}}">
		                <span class="icon-time"></span>
		                </a>
                    </td>
					<td>
						<a class="btn " href="{{=URL('admin','report/view', vars=dict(report=report.id))}}">
		                <span class="icon-eye-open"></span>
		                    {{=T('Report detail')}}
		                </a>
					</td>
				</tr>
                {{pass}}
                <tr>
                    <td colspan="10"></td>
                    <td>
                        <div><b>{{=T('Actions')}}:</b></div>
                        <a class="btn btn-success"
                           href="{{=URL('admin','dtt_approval', vars=dict(report=report.id, approve=True))}}">
		                <span class="icon-check"></span>
		                </a>
                        <a class="btn btn-danger"
                           href="{{=URL('admin','dtt_approval', vars=dict(report=report.id, approve=False))}}">
		                <span class="icon-remove"></span>
		                </a>
                        <a class="btn"
                           href="{{=URL('admin','dtt_approval', vars=dict(report=report.id))}}">
		                <span class="icon-time"></span>
		                </a></td>
                    <td>hola</td>
                </tr>
			</tbody>
		</table>
	</div>
</div>
