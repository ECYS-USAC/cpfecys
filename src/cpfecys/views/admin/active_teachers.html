{{extend 'template.html'}}
<script>
    var tableToExcel = (function() {
      var uri = 'data:application/vnd.ms-excel;base64,'
        , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
        , base64 = function(s) { return window.btoa(unescape(encodeURIComponent(s))) }
        , format = function(s, c) { return s.replace(/{(\w+)}/g, function(m, p) { return c[p]; }) }
      return function(table, name) {
        alert(document.getElementById(table).innerHTML);
        if (!table.nodeType) table = document.getElementById(table)
        var ctx = {worksheet: name || 'Worksheet', table: table.innerHTML}
        window.location.href = uri + base64(format(template, ctx))
      }
    })()
</script>
<div class="row-fluid">
    <div class="well span12">
    <h1>{{=T(actual_period.period.name)}} - {{=actual_period.yearp}}</h1>
        <a onclick="window.history.back()" class="btn" ><i class="icon-arrow-left"></i>{{=T('Back')}}</a>
        <a class="btn" onclick="tableToExcel('coso','Workbook')" >Descarga</a>
        <a href="{{=URL('admin', \
        'active_teachers/notifyall')}}"class="btn btn-info" >
            {{=T('Notify All')}}
        </a>
        <a href="{{=URL('admin', \
        'active_teachers/notifypending')}}"class="btn btn-success" >
            {{=T('Notify Pending')}}
        </a>
    <table class="table-striped table-hover table-bordered" style="align:0 auto;">
    <tr> 
      <td>
      <form class="form-inline" 
      action="{{=URL('admin','active_teachers')}}" 
        method='get'>
         <select name="period">
            {{for period in periods:}}
              <option value="{{=period.id}}">
              {{=T(period.period.name)}} - {{=period.yearp}}
              </option>
            {{pass}}
        </select>
        <input class="btn" type="submit" value="{{=T('Filter')}}">
      </form>
      </td>
    </tr>
    </table>
    <table id="coso" class="table table-striped table-bordered">
    <thead>
        <tr>
            <td>{{=T('Count')}}</td>
            <td>{{=T('Actions')}}</td>
            <td>{{=T('Name')}}</td>
            <td>{{=T('User code')}}</td>
            <td>{{=T('Email')}}</td>
            <td>{{=T('Phone')}}</td>
            <td>{{=T('Status')}}</td>
            <td>{{=T('Project')}}</td>
            <td>{{=T('Area')}}</td>
            <td>{{=T('Notify')}}</td>
        </tr>
    </thead>
    {{count = 0}}
    {{for assignation in assignations:}}
    {{count += 1}}
    <tbody>
        <tr>
            <td>{{=count}}</td>
            <td>
            {{if assignation.assigned_user.registration_key != 'blocked':}}
                <a href="
                    {{=URL('admin', 'active_teachers/toggle', \
                    vars=dict(user=assignation.assigned_user.id, \
                    period=actual_period.id))}}" 
                class="btn btn-info">{{=T('Disable')}}</a>
            {{else:}}
                <a href="
                    {{=URL('admin', 'active_teachers/toggle', \
                    vars=dict(user=assignation.assigned_user.id, \
                    period=actual_period.id))}}" 
                class="btn btn-important">{{=T('Enable')}}</a>
            {{pass}}
            </td>
            <td>
                {{=assignation.assigned_user.first_name}} 
                {{=assignation.assigned_user.last_name}} 
            </td>
            <td>
                {{=assignation.assigned_user.username}}
            </td>
            <td>
                {{=assignation.assigned_user.email or T('Pending')}}
            </td>
            <td>
                {{=assignation.assigned_user.phone or T('Pending')}}
            </td>
            <td>
                {{if assignation.assigned_user.registration_key != 'blocked':}}
                    <span class="badge badge-success">
                    {{=T('Enabled')}}
                    </span>
                {{else:}}
                <span class="badge badge-important">
                    {{=T('Disabled')}}
                </span>
                {{pass}}
            </td>
            <td>
                {{=assignation.project.name}} 
            </td>
            <td>
                {{=assignation.project.area_level.name}} 
            </td>
            <td>
                {{ user_id = assignation.assigned_user.id}}
                {{if assignation.assigned_user.load_alerted==True:}}
                    <a class="btn btn-success"
                    href="{{=URL('admin', \
                    'active_teachers/mail', \
                    vars=dict(user=user_id))}}">
                    {{=T('Re-notify')}}
                    </a>
                {{else:}}
                    <a class="btn btn-inverse"
                    href="{{=URL('admin', \
                    'active_teachers/mail', \
                    vars=dict(user=user_id))}}">
                    {{=T('Notify')}}
                    </a>
                {{pass}}
            </td>
        </tr>
    </tbody>
    {{pass}}
    </table>
    </div>
</div>