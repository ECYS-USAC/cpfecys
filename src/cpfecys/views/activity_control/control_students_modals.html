<!--Create weighting Modal -->
<div id="createWeighting" class="modal hide fade" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="width:800px; left:40%;"> 
    <div id ="a" class="modal-header">
        <h3 id="myModalLabel">
            {{if auth.has_membership('Teacher'):}}
              <h2>{{=T('Class Weighting')}} - {{=name}}
            {{else:}}
              <h2>{{=T('Laboratory Weighting')}} - {{=name}}
            {{pass}}
        </h3>
    </div>
    <div id="actions">
      <form action="" enctype="multipart/form-data" method="post" >
        <center>
          <table >
              <tr>
                <td align="left">                 
                  <div align="center" id="categoryDiv" value="categoryDiv" class="well span12" style="overflow:auto; height:200px; width:300px;">    
                    
                  </div>
                  
                </td>
                <td align="left"  >
                  <div class="well span11" id="div_weighting_show" style="overflow:auto; height:200px; width:300px;">
                    
                  </div>
                </td>
              </tr>
              <tr >
                <td>
                  <div align="right">
                    <a id="categoryButton" href="#information_text" role="button" class="btn btn-info"  
                    title="{{=T('Add category to weighting')}}"> 
                    <span class="icon-plus-sign"></span>
                    {{=T('Add Category')}}
                     </a>
                  </div>
                </td>
                <td >
                  <div align="right"> 
                    <button class="btn btn-primary" id="button_action"> {{=T('Update')}}</button>
                  </div>
                </td>
              </tr>
          </table>
         </center>      
        </div>

        <div align="center">

      </div>
    </form>
    </div>
  </div>
  <!--Finish Create weighting Modal -->
  



  <!--Get weighting Modal -->
<div id="getWeighting" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="width:800px; left:40%;"> 
    <div id ="a" class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
        <h3 id="myModalLabel">
            {{if auth.has_membership('Teacher'):}}
              <h2>{{=T('Class Weighting')}} - {{=name}}
            {{else:}}
              <h2>{{=T('Laboratory Weighting')}} - {{=name}}
            {{pass}}
        </h3>
    </div>
    <div id="actions">
      <form action="" enctype="multipart/form-data" method="post" >
        <center>
          <table >
              <tr>
                <td align="left">                 

                  <div align="center" id="categoryDiv" value="categoryDiv" class="well span12" style="overflow:auto; height:200px; width:300px;"> 
                    <table>
                      <tr>
                        <td>
                          <select class="generic-widget" id="period_id" name="category" style="width:250px;">
                            {{project_var = db(db.user_project.id == request.vars['assignation']).select().first() }}

                            {{if auth.has_membership('Teacher'):}}
                              {{cR = db( (db.course_activity_category.assignation==project_var.project.id) & (db.course_activity_category.laboratory==False)).select()}}
                            {{else:}}
                              {{cR = db( (db.course_activity_category.assignation==project_var.project.id) & (db.course_activity_category.laboratory==True)).select()}}
                            {{pass}}
                              
                              {{periodsP = []}}
                              {{for c in cR:}}
                                  {{periodsP.append(c.semester)}}
                              {{pass}}
                              {{for period_var in db(db.period_year.id.belongs(periodsP)).select():}}
                                  <option value="{{=period_var.id}}">{{=T(period_var.period.name)}} - {{=period_var.yearp}}</option>
                              {{pass}}
                          </select>
                        </td>
                        <td>
                          <a id="refreshButton" role="button" class="btn btn-info" title="{{=T('Refresh')}}"> 
                          <span class="icon-white icon-refresh"></span>
                           </a>
                        </td>
                      </tr>
                    </table>   
                    <div align="center" id="getDiv" style="overflow:auto; height:60%; width:100%;"> 

                    </div>
                    
                  </div>
                  
                </td>
                <td align="left"  >
                  <div class="well span11" id="getViewDiv" style="overflow:auto; height:200px; width:300px;">
                    
                  </div>
                </td>
              </tr>
              <tr >
                <td>
                  <div align="right">
                    <a id="getWeightingButton" role="button" class="btn btn-info"  
                    title="{{=T('Get weighting of the chosen semester')}}"> 
                    <span class="icon-plus-sign"></span>
                    {{=T('Get Weighting')}}
                     </a>
                  </div>
                </td>
                <td >
                  <div align="right"> 
                    <button class="btn btn-primary" id="button_action"> {{=T('Update')}}</button>
                    <button class="btn" data-dismiss="modal" aria-hidden="true">{{=T('Close')}}</button>
                  </div>
                </td>
              </tr>
          </table>
         </center>      
        </div>

        <div align="center">

      </div>
    </form>
    </div>
  </div>
  <!--Get  weighting Modal -->
  

  <script type="text/javascript">
  $(document).ready(function(){
    //Create
      $("#div_weighting_show").load("{{=URL('activity_control','weighting.html')}}?op=showTable&amp;assignation={{=request.vars['assignation']}}"); 
      $("#categoryDiv").load("{{=URL('activity_control','weighting.html')}}?op=showInsert&amp;assignation={{=request.vars['assignation']}}"); 
    


  	$("#categoryButton").click(function(){
		  var category_id_var = document.getElementById('category_id').value;
      var grade_var = document.getElementById('category_grade').value;
      var SG_var = document.getElementById('SG_check').checked;
      //alert(SG_var);
      if (category_id_var==""){
        alert("{{=T('No categories available')}}");
      }else{
      
      var regex = /^\d+(?:\.\d{0,2})$/; 
      var regex2 = /^([0-9])*$/; 

        if (grade_var=="" || parseInt(grade_var) == 0 ){
          alert("{{=T('The entered value is not correct')}}");  
        }else{
          if (!regex.test(grade_var) && !regex2.test(grade_var) ){
            alert("{{=T('The entered value is not a decimal')}}");  
          }else{

            
            $("#div_weighting_show").load("{{=URL('activity_control','weighting.html')}}?op=addCategory&amp;laboratory=true&amp;SG_var=" + SG_var + "&amp;category_id_var=" + category_id_var +"&amp;grade_var=" + grade_var + "&amp;TP=true&amp;assignation={{=request.vars['assignation']}}"); 
            
            $("#categoryDiv").load("{{=URL('activity_control','weighting.html')}}?op=showInsert&amp;assignation={{=request.vars['assignation']}}"); 
            $("#categoryDiv").load("{{=URL('activity_control','weighting.html')}}?op=showInsert&amp;assignation={{=request.vars['assignation']}}"); 
            }       

        }
      }
	 })
    $("#refreshButton").click(function(){
      var id_period_sel = document.getElementById('period_id').value;
      $("#getDiv").load("{{=URL('activity_control','weighting.html')}}?op=showTableNoEditablePeriod&amp;assignation={{=request.vars['assignation']}}&amp;period_par="+id_period_sel);
    })

    $("#getWeightingButton").click(function(){
      var id_period_sel = document.getElementById('period_id').value;
      $("#getViewDiv").load("{{=URL('activity_control','weighting.html')}}?op=getPreviousWeighting&amp;assignation={{=request.vars['assignation']}}&amp;period_par="+id_period_sel);
      //$("#getViewDiv").load("{{=URL('activity_control','weighting.html')}}?op=showEditTable&amp;assignation={{=request.vars['assignation']}}");
      
    })

  });

  </script>