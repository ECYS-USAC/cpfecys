{{extend 'template.html'}}
{{from datetime import datetime}}
<div class="row-fluid">
	<h1>
		{{=T('Report management grades')}}
		<br>
		<small>
			{{=T(year.period.name)}} {{=str(year.yearp)}}
		</small>
	</h1>
	<!--Search in report-->
	<div>
		<div>
			<input id="querySearch" name="querySearch" type="text" onclick="showT();" disabled/>
			<a id="buildSearch" class="btn">{{=T('Build Search')}} </a>
			<a id="executeSearch" class="btn">{{=T('Search')}}</a>
			<a id="cancelSearch" class="btn">{{=T('Clear')}}</a>
		</div>
		<div id="div_search" style="display: none;">
			<select class="generic-widget" id="categoryID" style="width:140px;">
				<option value="campo1">Campo1</option>
			</select>
			<select class="generic-widget" id="categoryID2" style="width:140px;">
				<option value="=">=</option>
			</select>
			<select class="generic-widget" id="categoryID3" style="width:140px;">
				<option value="=">=</option>
			</select>
			<a class="btn" title="{{=T('Start building a new search')}}" onclick="executeSearch();">{{=T('New Search')}}</a>
			<a class="btn" title="{{=T('Add this to the search as an AND term')}}" onclick="cancelSearch();">{{=T('+ And')}}</a>
			<a class="btn" title="{{=T('Add this to the search as an OR term')}}" onclick="executeSearch();">{{=T('+ Or')}}</a>
			<a class="btn" onclick="cancelSearch();">{{=T('Close')}}</a>
		</div>
	</div>
	<!--Search in report-->
	





	{{=grid}}
	<div style="overflow:auto; width:100%;">
		<table class="table table-striped table-bordered">
			<thead>
				<tr>
					<th><center>{{=T('Course')}}</center></th>
					<th><center>{{=T('Total inserted')}}</center></th>
					<th><center>{{=T('Total modified')}}</center></th>
					<th><center>{{=T('Total out')}}</center></th>
				</tr>
			</thead>
			<tbody>
				{{for assigantion in assigantions:}}
					<tr>
						<td>
							<a id="p{{=str(assigantion.project)}}_all" style="white-space:nowrap; cursor:pointer;">{{=str(assigantion.project.name)}}</a>
						</td>
						<td>
							<center>
								<a class="badge badge-success" style="white-space:nowrap;">
									{{=db((db.grades_log.project==assigantion.project.name)&(db.grades_log.yearp==year.yearp)&(db.grades_log.period==T(year.period.name))&(db.grades_log.operation_log=='insert')).count()}}
								</a>
							</center>
						</td>
						<td>
							<center>
								<a class="badge badge-info" style="white-space:nowrap;">
									{{=db((db.grades_log.project==assigantion.project.name)&(db.grades_log.yearp==year.yearp)&(db.grades_log.period==T(year.period.name))&(db.grades_log.operation_log=='update')).count()}}
								</a>
							</center>
						</td>
						<td>
							<center>
								<a class="badge badge-important" style="white-space:nowrap;">
									{{=db((db.grades_log.project==assigantion.project.name)&(db.grades_log.yearp==year.yearp)&(db.grades_log.period==T(year.period.name))&(db.grades_log.operation_log=='delete')).count()}}
								</a>
							</center>
						</td>
					</tr>
				{{pass}}
			{{for month in vecMonth:}}
				{{start = datetime.strptime(str(year.yearp) + '-' + str(month[0]) +'-01', "%Y-%m-%d")}}
				{{if month[2]==1:}}
        			{{end = datetime.strptime(str(year.yearp+1) + '-' + str(month[2]) +'-01', "%Y-%m-%d")}}
        		{{else:}}
        			{{end = datetime.strptime(str(year.yearp) + '-' + str(month[2]) +'-01', "%Y-%m-%d")}}
        		{{pass}}
			{{pass}}
			</tbody>
		</table>
	</div>
</div>

<script type="text/javascript">
	$(document).ready(function(){
		//INICIO --- Botones para realizar la ejecución o cancelación de la busqueda
		$("#buildSearch").click(function(){
			$("#div_search").slideDown();
		});

		$("#cancelSearch").click(function(){
			window.location.href = "{{=URL('activity_control', 'grades_management')}}";
		});

		$("#executeSearch").click(function(){
			if (document.getElementById('querySearch').value==""){
				alert("No existe una consulta para realizar la busqueda");
			}else{
				alert("Ejecutar Búsqueda");
			}
		});
		//FIN --- Botones para realizar la ejecución o cancelación de la busqueda


	});
</script>