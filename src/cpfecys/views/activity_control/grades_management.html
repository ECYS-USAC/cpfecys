{{extend 'template.html'}}
{{from datetime import datetime}}
<div class="row-fluid">
	<h1>
		{{=T('Report management grades')}}
		<br>
		<small>
			{{=T(year.period.name)}} {{=str(year.yearp)}}
		</small>
	</h1>
	<!--Search in report-->
	<div>
		<div>
			<input id="querySearch" name="querySearch" type="text" disabled/>
			<a id="buildSearch" class="btn">{{=T('Build Search')}} </a>
			<a id="executeSearch" class="btn">{{=T('Search')}}</a>
			<a id="cancelSearch" class="btn">{{=T('Clear')}}</a>
		</div>
		<div id="div_search" style="display: none;">
			<table>
				<tr>
					<td>
						<select class="generic-widget" id="fieldSearch">
						{{for field in vecFieldsSearch:}}
							<option value="{{=str(field[1])}}">{{=str(field[0])}}</option>
						{{pass}}
						</select>
					</td>
					<td>
						<select class="generic-widget" id="optionSearch">
						{{for option in vecOptionSearch:}}
							<option value="{{=str(option[0])}}">{{=str(option[0])}}</option>
						{{pass}}
						</select>
					</td>
					<td>
						{{contadorT=0}}
						{{for fieldSearch in vecFieldsSearch:}}
							{{valuesSearch = 'valuesSearch_'+fieldSearch[1]}}
							{{if fieldSearch[2]=='1':}}
								{{if contadorT==0:}}
									<select class="generic-widget" id="{{=valuesSearch}}">
								{{else:}}
									<select class="generic-widget" id="{{=valuesSearch}}" style="display:none;">
								{{pass}}
									<option value=""></option>
								{{for values in fieldSearch[3]:}}
									{{if fieldSearch[1]=='roll':}}
										<option value="{{=values}}">{{=T(values)}}</option>
									{{else:}}
										<option value="{{=values}}">{{=values}}</option>
									{{pass}}
								{{pass}}
								{</select>
							{{elif fieldSearch[2]=='2' or fieldSearch[2]=='3':}}
								{{if contadorT==0:}}
									<input id="{{=valuesSearch}}" type="text" value="{{=valuesSearch}}"/>
								{{else:}}
									<input id="{{=valuesSearch}}" type="text" value="{{=valuesSearch}}" style="display:none;"/>
								{{pass}}
							{{pass}}
							{{contadorT=1}}
						{{pass}}
					</td>
					<td>
						<a id="newSearch" class="btn" title="{{=T('Start building a new search')}}">{{=T('New Search')}}</a>
						<a id="andSearch" class="btn" title="{{=T('Add this to the search as an AND term')}}">{{=T('+ And')}}</a>
						<a id="orSearch" class="btn" title="{{=T('Add this to the search as an OR term')}}">{{=T('+ Or')}}</a>
						<a id="closeSearch" class="btn">{{=T('Close')}}</a>
					</td>
				</tr>
			</table>
		</div>
	</div>
	<!--Search in report-->
	<div style="overflow:auto; width:100%;">
		<table class="table table-striped table-bordered">
			<thead>
				<tr>
					<th><center>{{=T('Course')}}</center></th>
					<th><center>{{=T('Total inserted')}}</center></th>
					<th><center>{{=T('Total modified')}}</center></th>
					<th><center>{{=T('Total out')}}</center></th>
				</tr>
			</thead>
			<tbody>
				{{for assigantion in assigantions:}}
					<tr>
						<td>
							<a id="p{{=str(assigantion.project)}}_all" style="white-space:nowrap; cursor:pointer;">{{=str(assigantion.project.name)}}</a>
						</td>
						<td>
							<center>
								<a class="badge badge-success" style="white-space:nowrap;">
									{{=db((db.grades_log.project==assigantion.project.name)&(db.grades_log.yearp==year.yearp)&(db.grades_log.period==T(year.period.name))&(db.grades_log.operation_log=='insert')).count()}}
								</a>
							</center>
						</td>
						<td>
							<center>
								<a class="badge badge-info" style="white-space:nowrap;">
									{{=db((db.grades_log.project==assigantion.project.name)&(db.grades_log.yearp==year.yearp)&(db.grades_log.period==T(year.period.name))&(db.grades_log.operation_log=='update')).count()}}
								</a>
							</center>
						</td>
						<td>
							<center>
								<a class="badge badge-important" style="white-space:nowrap;">
									{{=db((db.grades_log.project==assigantion.project.name)&(db.grades_log.yearp==year.yearp)&(db.grades_log.period==T(year.period.name))&(db.grades_log.operation_log=='delete')).count()}}
								</a>
							</center>
						</td>
					</tr>
				{{pass}}
			{{for month in vecMonth:}}
				{{start = datetime.strptime(str(year.yearp) + '-' + str(month[0]) +'-01', "%Y-%m-%d")}}
				{{if month[2]==1:}}
        			{{end = datetime.strptime(str(year.yearp+1) + '-' + str(month[2]) +'-01', "%Y-%m-%d")}}
        		{{else:}}
        			{{end = datetime.strptime(str(year.yearp) + '-' + str(month[2]) +'-01', "%Y-%m-%d")}}
        		{{pass}}
			{{pass}}
			</tbody>
		</table>
	</div>
</div>

<script type="text/javascript">
	$(document).ready(function(){
		//INICIO --- Botones para realizar la ejecución o cancelación de la busqueda
		$("#buildSearch").click(function(){
			$("#div_search").slideDown();
		});

		$("#cancelSearch").click(function(){
			window.location.href = "{{=URL('activity_control', 'grades_management')}}";
		});

		$("#executeSearch").click(function(){
			if (document.getElementById('querySearch').value==""){
				alert("No existe una consulta para realizar la busqueda");
			}else{
				alert("Ejecutar Búsqueda");
			}
		});
		//FIN --- Botones para realizar la ejecución o cancelación de la busqueda

		//INICIO --- Botones para realizar la construcción del query
		$("#closeSearch").click(function(){
			$("#div_search").slideUp();
		});


		$("#fieldSearch").change(function(){
			{{for fieldSearch in vecFieldsSearch:}}
				{{valuesSearch = 'valuesSearch_'+fieldSearch[1]}}
				$("#{{=valuesSearch}}").css("display", "none");
			{{pass}}

			{{for fieldSearch in vecFieldsSearch:}}
				{{valuesSearch = 'valuesSearch_'+fieldSearch[1]}}
				if (document.getElementById('fieldSearch').value == '{{=str(fieldSearch[1])}}'){
					$("#{{=valuesSearch}}").css("display", "block");
				}
			{{pass}}
		});

		//FIN --- Botones para realizar la construcción del query
	});
</script>