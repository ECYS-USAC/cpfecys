{{if request.vars['initial']=="y" and request.vars['op']=="controlActivities":}}
	{{weighting = db((db.request_change_weighting.status=='pending')&(db.request_change_weighting.project==request.vars['project'])).select().first()}}
	{{if weighting!=None:}}
		{{if Draft!=None:}}
			{{db(db.requestchange_activity.id==Draft.id).delete()}}
		{{pass}}
		<script type="text/javascript">
			jQuery('#div_request_show').empty();
			alert("{{=T('You can not create a change request activity since there is a change request weighting is not answered.')}}");
			window.location.href = "{{=URL('activity_control', 'request_change_activity',vars=dict(project=project.id, year=period.id))}}";
		</script>
	{{else:}}
		{{rgrades = db((db.request_change_grades.status=='pending')&(db.request_change_grades.period==int(period.id))&(db.request_change_grades.project==int(project.id))).select()}}
		{{if rgrades.first()==None:}}
			<!--Insert the request change activity like draft-->
			{{Draft = db.requestchange_activity.insert(user_id=auth.user.id, roll='Student', status='Draft', semester = int(period.id), course = int(project.id), course_activity_category=int(cat.id))}}
		{{else:}}
			{{validation_change=False}}
			{{acrc_t = db((db.course_activity.course_activity_category==int(cat.id))&(db.course_activity.semester==int(period.id))&(db.course_activity.assignation==int(project.id))&(db.course_activity.laboratory==True)).select()}}
			{{for rgrades_iterator in rgrades:}}
				{{for acrc in acrc_t:}}
					{{if rgrades_iterator.activity==acrc.id:}}
						{{validation_change=True}}
					{{pass}}
				{{pass}}
			{{pass}}
			{{if validation_change==False:}}
				<!--Insert the request change activity like draft-->
				{{Draft = db.requestchange_activity.insert(user_id=auth.user.id, roll='Student', status='Draft', semester = int(period.id), course = int(project.id), course_activity_category=int(cat.id))}}
			{{else:}}
				{{if Draft!=None:}}
					{{db(db.requestchange_activity.id==Draft.id).delete()}}
				{{pass}}
				<script type="text/javascript">
					jQuery('#div_request_show').empty();
					alert("{{=T('You can not create a change request activity while there is a change request notes in an activity that is within the category to which you want to apply the changes.')}}");
					window.location.href = "{{=URL('activity_control', 'request_change_activity',vars=dict(project=project.id, year=period.id))}}";
				</script>
			{{pass}}
		{{pass}}
	{{pass}}
{{pass}}


{{if request.vars['op'] == "createRequestChangeL":}}
	{{if stateRequest==-1:}}
		<script type="text/javascript">
            alert("{{=T('The change request activities in which you are working has been deleted by another user')}}");
            window.location.href = "{{=URL('activity_control', 'request_change_activity',vars=dict(project=project.id, year=period.id))}}";
        </script>
	{{elif stateRequest==2:}}
		<script type="text/javascript">
            alert("{{=T('You have created the change request successfully. It is failure notice to teacher in charge of the course')}}");
            window.location.href = "{{=URL('activity_control', 'request_change_activity',vars=dict(project=project.id, year=period.id))}}";
        </script>
	{{elif stateRequest==4:}}
		<script type="text/javascript">
            alert("{{=T('You have created the change request successfully. It is reported by email to teacher in charge of the course')}}");
            window.location.href = "{{=URL('activity_control', 'request_change_activity',vars=dict(project=project.id, year=period.id))}}";
        </script>
	{{elif stateRequest==5:}}
		<script type="text/javascript">
            alert("{{=T('You can not create a change request activity while there is a change request notes in an activity that is within the category to which you want to apply the changes.')}}");
            window.location.href = "{{=URL('activity_control', 'request_change_activity',vars=dict(project=project.id, year=period.id))}}";
        </script>
	{{pass}}
{{pass}}



{{if request.vars['op'] == "solveActivityRequestDetail":}}
	{{Request = db(db.requestchange_activity.id==int(request.vars['Idrequest'])).select().first()}}
	{{if Request is None:}}
		<script type="text/javascript">
			jQuery('#controlActivity').empty();
            alert("{{=T('You do not have permission to view course requests')}}");
            window.location.href = "{{=URL('default', 'index')}}";
        </script>
	{{else:}}
		<label id="idR" value="{{=Request.id}}" style="display=none;"></label>
		<table class="table table-striped table-bordered">
			<tr>
				<th colspan="6"><center>{{=T('Change Request')}}</center></th>
			</tr>
			<tr>
				<th>{{=T('User')}}</th><td>{{=Request.user_id.username}}</td>
				<th>{{=T('Role')}}</th>
				{{if Request.roll == "Student":}}
					<td>{{=T('Tutor academico')}}</td>
				{{else:}}
					<td>{{=T(Request.roll)}}</td>
				{{pass}}
				<th>{{=T('Date Request')}}</th><td>{{=Request.date_request}}</td>
			</tr>
			<tr>
				<th>{{=T('Category')}}:</th>
				<td colspan="2"><center>{{=Request.course_activity_category.category.category}}</center></td>
				<th>{{=T('Status')}}:</th>
				<th colspan="2"><FONT COLOR="#5E610B">{{=T(Request.status)}}</font></th>
			</tr>
			<tr>
				<th>{{=T('User resolution')}}</th>
				<td>---</td>
				<th>{{=T('Date of resolution')}}</th>
				<td>---</td>
				<th>{{=T('Role resolution')}}</th>
				<td>---</td>
			</tr>
			<tr>
				<th>{{=T('Description')}}:</th>
				<td colspan="5"><pre>{{=Request.description}}</pre></td>
			</tr>
			<tr>
				<th colspan="6"><center>{{=T('Detail of Request')}}</center></th>
			</tr>
			<tr>
				<th>{{=T('Operation')}}</th>
				<th>{{=T('Name Activity')}}</th>
				<th>{{=T('Description of Activity')}}</th>
				<th>{{=T('Grade of Activity')}} </th>
				<th>{{=T('Start Date')}}</th>
				<th>{{=T('End Date')}}</th>
			</tr>
			{{for change in db(db.requestchange_course_activity.requestchange_activity==Request.id).select():}}
				<tr>
					<td>{{=change.operation_request}}</td>
					<td>{{=change.name}}</td>
					<td>
						<div style="width:200px;">
							{{=change.description[:100]}}
							{{if len(change.description) > 100:}}...
								<br>
								<div align="right">
									<a type="button" style ="cursor:pointer;" role="button" data-toggle="modal" data-target="#des_DetailCa_modal_{{=change.id}}" >{{=T('View more')}}</span></a>
								</div>
						
								<!--MODAL -->
								<div id="des_DetailCa_modal_{{=change.id}}" class="modal hide fade" tabindex="-1" role="dialog"  aria-hidden="true"> 
								  <div class="modal-header">
								    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
								      <h3 id="myModalLabel">
								          {{=change.name}}
								      </h3>
								  </div>
								  <div class="modal-body">
								    <div class="well">
								        <pre>
								           {{=change.description}}
								        </pre>
								    </div>
								  </div>
								  <div class="modal-footer">
								      <button class="btn" data-dismiss="modal" aria-hidden="true">{{=T('Close')}}</button>
								  </div>
								</div>
								<!--Finish MODaL-->
							{{pass}}
						</div>
					</td>
					<td>
						{{if change.grade == float(0):}}
							<label style ="cursor:help;" title="{{=T('The grade of')}} '{{=Request.course_activity_category.category.category}}' {{=T('is averaged.')}}">
								{{=T('AG')}}
							</label>
						{{else:}}
							{{=change.grade}}
						{{pass}}
					</td>
					<td>{{=change.date_start}}</td>
					<td>{{=change.date_finish}}</td>
				</tr>
			{{pass}}
			<tr>
				<td colspan="4"></td>
				<td><center>
					<a class="btn btn-danger" title="{{=T('Cancel the change request')}}" href="{{=URL('activity_control', 'requestchangeactivity/reject', vars=dict(requestID=Request.id, project=project.id, year=period.id))}}">
						{{=T('Cancel request')}}
					</a>
				</center></td>
				<td><center>
					<a class="btn" title="{{=T('Close the detail of the change request')}}" onclick="closeDetail();">{{=T('Close Detail')}}</a>
				</center></td>
			</tr>
		</table>
	{{pass}}
{{pass}}


<!--Others-->
{{if request.vars['op']=="solveActivityRequestDetailO":}}
	{{Request = db(db.requestchange_activity_log.id==int(request.vars['Idrequest'])).select().first()}}
	{{if Request is None:}}
		<script type="text/javascript">
			jQuery('#controlActivity').empty();
            alert("{{=T('You do not have permission to view course requests')}}");
            window.location.href = "{{=URL('default', 'index')}}";
        </script>
	{{else:}}
		<table class="table table-striped table-bordered">
			<tr>
				<th colspan="6"><center>{{=T('Change Request')}}</center></th>
			</tr>
			<tr>
				<th>{{=T('User')}}</th><td>{{=Request.user_request}}</td>
				<th>{{=T('Role')}}</th>
				{{if Request.roll_request == "Student":}}
					<td>{{=T('Tutor academico')}}</td>
				{{else:}}
					<td>{{=T(Request.roll_request)}}</td>
				{{pass}}
				<th>{{=T('Date Request')}}</th><td>{{=Request.date_request}}</td>
			</tr>
			<tr>
				<th>{{=T('Category')}}:</th>
				<td colspan="2"><center>{{=Request.category_request}}</center></td>
				<th>{{=T('Status')}}:</th>
				{{if Request.status=='Accepted':}}
					<th colspan="2"><center><FONT COLOR="Green">{{=T(Request.status)}}</center></font></th>
				{{else:}}
					<th colspan="2"><center><FONT COLOR="Red">{{=T(Request.status)}}</center></font></th>
				{{pass}}
			</tr>
			<tr>
				<th>{{=T('User resolution')}}</th>
				{{usuarioR = db(db.auth_user.username==Request.user_resolve).select().first()}}
				{{if usuarioR==None:}}
					<td>{{=usuarioR.first_name}} {{=usuarioR.last_name}}</td>
				{{else:}}
					<td>{{=Request.user_resolve}}</td>
				{{pass}}
				<th>{{=T('Role resolution')}}</th>
				{{if Request.roll_resolve == "Student":}}
					<td>{{=T('Tutor academico')}}</td>
				{{else:}}
					<td>{{=T(Request.roll_resolve)}}</td>
				{{pass}}
				<th>{{=T('Date of resolution')}}</th>
				<td>{{=Request.date_request_resolve}}</td>
			</tr>
			<tr>
				<th>{{=T('Description')}}:</th>
				<td colspan="5"><pre>{{=Request.description}}</pre></td>
			</tr>
			<tr>
				<th colspan="6"><center>{{=T('Detail of Request')}}</center></th>
			</tr>
			<tr>
				<th>{{=T('Operation')}}</th>
				<th>{{=T('Name Activity')}}</th>
				<th>{{=T('Description of Activity')}}</th>
				<th>{{=T('Grade of Activity')}} </th>
				<th>{{=T('Start Date')}}</th>
				<th>{{=T('End Date')}}</th>
			</tr>
			{{for change in db(db.requestchange_course_activity_log.requestchange_activity==Request.id).select():}}
				<tr>
					<td>{{=change.operation_request}}</td>
					<td>{{=change.name}}</td>
					<td>
						<div style="width:200px;">
							{{=change.description[:100]}}
							{{if len(change.description) > 100:}}...
								<br>
								<div align="right">
									<a type="button" style ="cursor:pointer;" role="button" data-toggle="modal" data-target="#des_DetailCl_modal_{{=change.id}}" >{{=T('View more')}}</span></a>
								</div>
						
								<!--MODAL -->
								<div id="des_DetailCl_modal_{{=change.id}}" class="modal hide fade" tabindex="-1" role="dialog"  aria-hidden="true"> 
								  <div class="modal-header">
								    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
								      <h3 id="myModalLabel">
								          {{=change.name}}
								      </h3>
								  </div>
								  <div class="modal-body">
								    <div class="well">
								        <pre>
								           {{=change.description}}
								        </pre>
								    </div>
								  </div>
								  <div class="modal-footer">
								      <button class="btn" data-dismiss="modal" aria-hidden="true">{{=T('Close')}}</button>
								  </div>
								</div>
								<!--Finish MODaL-->
							{{pass}}
						</div>
					</td>
					<td>
						{{if change.grade == float(0):}}
							<label style ="cursor:help;" title="{{=T('The grade of')}} '{{=Request.category_request}}' {{=T('is averaged.')}}">
								{{=T('AG')}}
							</label>
						{{else:}}
							{{=change.grade}}
						{{pass}}
					</td>
					<td>{{=change.date_start}}</td>
					<td>{{=change.date_finish}}</td>
				</tr>
			{{pass}}
			<tr>
				<td colspan="5"></td>
				<td><center>
					<a class="btn" title="{{=T('Close the detail of the change request')}}" onclick="closeDetail();">{{=T('Close Detail')}}</a>
				</center></td>
			</tr>
		</table>
	{{pass}}
{{pass}}




<!--******************************************************************************************************************-->
<!--******************************************************************************************************************-->
<!--******************************************************************************************************************-->
<!--******************************************************************************************************************-->
<!--******************************************************************************************************************-->



{{if request.vars['op'] == "showRequestDone":}}
	{{RallRequestP=None}}
	{{RallRequest=None}}
	{{if request.vars['tip']=="p" or request.vars['tip']=="t":}}
			{{RallRequestP = db((db.requestchange_activity.status=='Pending')&(db.requestchange_activity.semester==int(period.id))&(db.requestchange_activity.course==project.id)).select()}}
		{{pass}}
	{{if request.vars['tip']=="a":}}
		{{RallRequest = db((db.requestchange_activity_log.status=='Accepted')&(db.requestchange_activity_log.course==project.name)&(db.requestchange_activity_log.yearp==period.yearp)&(db.requestchange_activity_log.semester==period.period.name)).select()}}
	{{pass}}
	{{if request.vars['tip']=="r":}}
		{{RallRequest = db((db.requestchange_activity_log.status=='Rejected')&(db.requestchange_activity_log.course==project.name)&(db.requestchange_activity_log.yearp==period.yearp)&(db.requestchange_activity_log.semester==period.period.name)).select()}}
	{{pass}}
	{{if request.vars['tip']=="t":}}
		{{RallRequest = db((db.requestchange_activity_log.status!='Pending')&(db.requestchange_activity_log.course==project.name)&(db.requestchange_activity_log.yearp==period.yearp)&(db.requestchange_activity_log.semester==period.period.name)).select()}}
	{{pass}}


	{{if (request.vars['tip']=="p" and (RallRequestP != None and RallRequestP.first()!=None)) or (request.vars['tip']=="a" and (RallRequest != None and RallRequest.first()!=None)) or (request.vars['tip']=="r" and (RallRequest != None and RallRequest.first()!=None)) or (request.vars['tip']=="t" and ((RallRequest != None and RallRequest.first()!=None) or (RallRequestP != None and RallRequestP.first()!=None))):}}
		<table class="table table-striped table-bordered">
			<tr>
				<th>{{=T('Category')}}</th>
				<th>{{=T('User')}}</th>
				<th>{{=T('Role')}} </th>
				<th>{{=T('Status')}}</th>
				<th>{{=T('Date Request')}}</th>
				<th>{{=T('Action')}}</th>
			</tr>
		{{if RallRequestP!=None:}}
			{{for change1 in RallRequestP:}}
				<tr>
					<td>{{=change1.course_activity_category.category.category}}</td>
					<td>{{=change1.user_id.username}}</td>
					{{if change1.roll == "Student":}}
						<td>{{=T('Tutor academico')}}</td>
					{{else:}}
						<td>{{=T(change1.roll)}}</td>
					{{pass}}
					<td>{{=T(change1.status)}}</td>
					<td>{{=change1.date_request}}</td>
					<td>
						<a class="btn" title="{{=T('View the change request')}}" onclick="detail({{=change1.id}});">{{=T('Detail')}}</a>
					</td>
				</tr>
			{{pass}}
		{{pass}}
		{{if RallRequest!=None:}}
			{{for change in RallRequest:}}
				<tr>
					<td>{{=change.category_request}}</td>
					<td>{{=change.user_request}}</td>
					{{if change.roll_request == "Student":}}
						<td>{{=T('Tutor academico')}}</td>
					{{else:}}
						<td>{{=T(change.roll)}}</td>
					{{pass}}
					<td>{{=T(change.status)}}</td>
					<td>{{=change.date_request}}</td>
					<td>
						<a class="btn" title="{{=T('View the change request')}}" onclick="detailT({{=change.id}});">{{=T('Detail')}}</a>
					</td>
				</tr>
			{{pass}}
		{{pass}}
		</table>
	{{else:}}
		<h1>{{=T('There is no request')}}</h1>
	{{pass}}
{{pass}}


<!--******************************************************************************************************************-->
<!--******************************************************************************************************************-->
<!--******************************************************************************************************************-->
<!--******************************************************************************************************************-->
<!--******************************************************************************************************************-->

<!--UPDATE ACTIVITY-->
{{if request.vars['op'] == "updateActivity":}}
	{{weighting = db((db.request_change_weighting.status=='pending')&(db.request_change_weighting.project==request.vars['project'])).select().first()}}
	{{if weighting!=None:}}
		{{if Draft!=None:}}
			{{db(db.requestchange_activity.id==Draft.id).delete()}}
		{{pass}}
		<script type="text/javascript">
			jQuery('#div_request_show').empty();
			alert("{{=T('You can not create a change request activity since there is a change request weighting is not answered.')}}");
			window.location.href = "{{=URL('activity_control', 'request_change_activity',vars=dict(project=project.id, year=period.id))}}";
		</script>
	{{else:}}
		{{functionAction=False}}
		{{rgrades = db((db.request_change_grades.status=='pending')&(db.request_change_grades.period==int(period.id))&(db.request_change_grades.project==int(project.id))).select()}}
		{{if rgrades.first()==None:}}
			{{functionAction=True}}
		{{else:}}
			{{validation_change=False}}
			{{acrc_t = db((db.course_activity.course_activity_category==int(request.vars['category']))&(db.course_activity.semester==int(period.id))&(db.course_activity.assignation==int(project.id))&(db.course_activity.laboratory==True)).select()}}
			{{for rgrades_iterator in rgrades:}}
				{{for acrc in acrc_t:}}
					{{if rgrades_iterator.activity==acrc.id:}}
						{{validation_change=True}}
					{{pass}}
				{{pass}}
			{{pass}}
			{{if validation_change==False:}}
				{{functionAction=True}}
			{{else:}}
				{{if Draft!=None:}}
					{{db(db.requestchange_activity.id==Draft.id).delete()}}
				{{pass}}
				<script type="text/javascript">
					jQuery('#div_request_show').empty();
					alert("{{=T('You can not create a change request activity while there is a change request notes in an activity that is within the category to which you want to apply the changes.')}}");
					window.location.href = "{{=URL('activity_control', 'request_change_activity',vars=dict(project=project.id, year=period.id))}}";
				</script>
			{{pass}}
		{{pass}}
		{{if functionAction==True:}}
			{{if Draft==None:}}
				<script type="text/javascript">
					jQuery('#div_request_show').empty();
		            alert("{{=T('The change request activities in which you are working has been deleted by another user')}}");
		            window.location.href = "{{=URL('default', 'index')}}";
		        </script>
			{{else:}}
				{{if Draft.course_activity_category!=int(request.vars['category']):}}
					<script type="text/javascript">
						jQuery('#div_request_show').empty();
			            alert("{{=T('The change request activities in which you are working has been deleted by another user')}}");
			            window.location.href = "{{=URL('default', 'index')}}";
			        </script>
				{{else:}}
					{{
						from datetime import datetime
						date1=None
					    try:
					        date1 = datetime.strptime(request.vars['edit_dateInit_var'], "%Y/%m/%d")
					    except:
					        try:
					        	date1 = datetime.strptime(request.vars['edit_dateInit_var'], "%Y-%m-%d")
					        except:
					        	date1=None
					        pass
					    pass
					    if date1 is not None:
							dateInicialP = db.executesql('SELECT date(\''+request.vars['edit_dateInit_var']+'\');',as_dict=True)
							for d0 in dateInicialP:
								date1=d0['date(\''+request.vars['edit_dateInit_var']+'\')']
							pass
					    pass

					    #********************************************************************************
					    #********************************************************************************
					    #********************************************************************************
					    date2=None
					    try:
					        date2 = datetime.strptime(request.vars['edit_dateEnd_var'], "%Y/%m/%d")
					    except:
					    	try:
					    		date2 = datetime.strptime(request.vars['edit_dateEnd_var'], "%Y-%m-%d")
					    	except:
					        	date2=None
					        pass
					    pass
					    if date2 is not None:
					    	dateInicialP2 = db.executesql('SELECT date(\''+request.vars['edit_dateEnd_var']+'\');',as_dict=True)
							for d0 in dateInicialP2:
								date2=d0['date(\''+request.vars['edit_dateEnd_var']+'\')']
							pass
					    pass
					}}
					{{if date1==None or date2==None:}}
						<script type="text/javascript"> 
							alert("{{=T('One of the date or both are incorrect')}}"); 
						</script>
					{{else:}}
						{{actualSemester = db(db.period_year.id==request.vars['year']).select().first()}}
						{{comparacion = T(actualSemester.period.name)+" "+str(actualSemester.yearp)}}
						{{date_var = db((db.student_control_period.period_name==comparacion)).select().first()}}

						{{if date1>= date_var.date_start_semester and date2<= date_var.date_finish_semester:}}
							{{comprobation=False}}
							{{dateC2=None}}
							{{maximTimeCategory = db.executesql('SELECT DATE_ADD(\''+str(date2)+'\', INTERVAL '+str(date_var.timeout_income_notes)+' Day) as fecha;',as_dict=True)}}
							{{for d0 in maximTimeCategory:}}
								{{dateC2=d0['fecha']}}
							{{pass}}
							{{if str(dateC2)>str(date_var.date_finish_semester):}}
								<script type="text/javascript"> 
									alert("{{=T('The end date of the activity over the time you have to enter notes exceeds timeout semester')}}"); 
								</script>
							{{else:}}
								{{comprobation=True}}
							{{pass}}

							{{if comprobation==True:}}
								{{changeActivities = db(db.requestchange_course_activity.requestchange_activity==Draft.id).select()}}
								{{tActivities = db((db.course_activity.semester==period.id)&(db.course_activity.assignation==project.id)&(db.course_activity.laboratory=='T')&(db.course_activity.course_activity_category==cat.id)).select()}}

								{{vecAct1=[]}}
								{{vecAct2=[]}}
								{{totalChanges=0}}
								<!--Activities that has change-->
								{{for c1 in changeActivities:}}
									{{if c1.operation_request=='insert':}}
										{{if c1.activity==None and request.vars['var_id'] == "0" and request.vars['var_name'] == c1.name:}}
											{{None}}
										{{else:}}
											{{vecAct2.append(c1.name)}}
											{{vecAct2.append(c1.grade)}}
											{{vecAct1.append(vecAct2)}}
											{{vecAct2=[]}}
										{{pass}}
									{{else:}}
										{{totalChanges=totalChanges+1}}
									{{pass}}
								{{pass}}
								<!--Activities originals-->
								{{vecAct2=[]}}
								{{exist=0}}
								{{for c2 in tActivities:}}
									{{if totalChanges>0:}}
										{{for c1 in changeActivities:}}
											{{if c1.activity==c2.id:}}
												{{exist=1}}
												{{if c1.operation_request=='update':}}
													{{if request.vars['var_id'] == str(c2.id):}}
														{{None}}
													{{else:}}
														{{vecAct2.append(c1.name)}}
														{{vecAct2.append(c1.grade)}}
														{{vecAct1.append(vecAct2)}}
														{{vecAct2=[]}}
													{{pass}}
												{{pass}}
											{{pass}}
										{{pass}}
										{{if exist==0:}}
											{{if request.vars['var_id'] == str(c2.id) and request.vars['var_name'] == c2.name:}}
												{{None}}
											{{else:}}
												{{vecAct2.append(c2.name)}}
												{{vecAct2.append(c2.grade)}}
												{{vecAct1.append(vecAct2)}}
												{{vecAct2=[]}}
											{{pass}}
										{{pass}}
									{{else:}}
										{{if request.vars['var_id'] == str(c2.id) and request.vars['var_name'] == c2.name:}}
											{{None}}
										{{else:}}
											{{vecAct2.append(c2.name)}}
											{{vecAct2.append(c2.grade)}}
											{{vecAct1.append(vecAct2)}}
											{{vecAct2=[]}}
										{{pass}}
									{{pass}}
									{{vecAct2=[]}}
									{{exist=0}}
								{{pass}}	
								<!--Check-->
								{{existName='false'}}
								{{total_var2=float(request.vars['edit_field_grade_var'])}}
								{{for a1 in vecAct1:}}
									{{if a1[0] == request.vars['edit_activity_name1_var']:}}
										{{existName='true'}}
									{{pass}}
									{{total_var2=total_var2+float(a1[1])}}
								{{pass}}

								{{refres=0}}
								{{if existName=='false':}}
									{{if cat.specific_grade==True:}}
										{{if float(total_var2)<=float(cat.grade):}}
											{{refres=1}}
										{{else:}}
											<script type="text/javascript"> 
												alert("{{=T('The sum of the ratings of the activities exceeds the limit of the category') }}  ({{=str(total_var2)}} / {{=str(cat.grade)}})"); 
											</script>
										{{pass}}
									{{else:}}
										{{refres=1}}
									{{pass}}


									{{if refres==1:}}
										{{change=0}}
										{{for c1 in changeActivities:}}
											{{if c1.operation_request=='insert':}}
												{{if c1.activity==None and request.vars['var_id'] == "0" and request.vars['var_name'] == c1.name:}}
													{{db(db.requestchange_course_activity.id==c1.id).update(name=request.vars['edit_activity_name1_var'], description = request.vars['edit_activity_description_var'], grade = float(request.vars['edit_field_grade_var']), date_start = request.vars['edit_dateInit_var'], date_finish=request.vars['edit_dateEnd_var'])}}
													{{change=1}}
												{{pass}}
											{{elif c1.operation_request=='update':}}
												{{if request.vars['var_id'] == str(c1.activity) and request.vars['var_name'] == c1.name:}}
													{{db(db.requestchange_course_activity.id==c1.id).update(name=request.vars['edit_activity_name1_var'], description = request.vars['edit_activity_description_var'], grade = float(request.vars['edit_field_grade_var']), date_start = request.vars['edit_dateInit_var'], date_finish=request.vars['edit_dateEnd_var'])}}
													{{change=1}}
												{{pass}}
											{{pass}}
										{{pass}}
										<!--Activities originals-->
										{{if change==0:}}
											{{for c2 in tActivities:}}
												{{if request.vars['var_id'] == str(c2.id) and request.vars['var_name'] == c2.name:}}
													{{if request.vars['edit_activity_name1_var']!=c2.name or c2.description!=request.vars['edit_activity_description_var'] or c2.grade!=float(request.vars['edit_field_grade_var']) or c2.date_start!=date1 or c2.date_finish!=date2:}}
														{{db.requestchange_course_activity.insert(requestchange_activity=Draft.id, operation_request = 'update', name=request.vars['edit_activity_name1_var'], description = request.vars['edit_activity_description_var'], grade = float(request.vars['edit_field_grade_var']), date_start = request.vars['edit_dateInit_var'], date_finish=request.vars['edit_dateEnd_var'],activity=c2.id)}}
													{{pass}}
												{{pass}}
											{{pass}}
										{{pass}}
									{{pass}}
								{{else:}}
									<script type="text/javascript"> 
										alert("{{=T('the name of the registered activity already exists.')}}"); 
									</script>
								{{pass}}

							{{pass}}
						{{else:}}
							<script type="text/javascript"> 
								alert("{{=T('The date range of activities are not within the range of the semester')}} ({{=date_var.date_start_semester}} - {{=date_var.date_finish_semester}})"); 
							</script>
						{{pass}}

					{{pass}}
				{{pass}}
			{{pass}}
		{{pass}}
	{{pass}}
{{pass}}


<!--CREATE ACTIVITY-->
{{if request.vars['op'] == "createActivity":}}
	{{weighting = db((db.request_change_weighting.status=='pending')&(db.request_change_weighting.project==request.vars['project'])).select().first()}}
	{{if weighting!=None:}}
		{{if Draft!=None:}}
			{{db(db.requestchange_activity.id==Draft.id).delete()}}
		{{pass}}
		<script type="text/javascript">
			jQuery('#div_request_show').empty();
			alert("{{=T('You can not create a change request activity since there is a change request weighting is not answered.')}}");
			window.location.href = "{{=URL('activity_control', 'request_change_activity',vars=dict(project=project.id, year=period.id))}}";
		</script>
	{{else:}}
		{{functionAction=False}}
		{{rgrades = db((db.request_change_grades.status=='pending')&(db.request_change_grades.period==int(period.id))&(db.request_change_grades.project==int(project.id))).select()}}
		{{if rgrades.first()==None:}}
			{{functionAction=True}}
		{{else:}}
			{{validation_change=False}}
			{{acrc_t = db((db.course_activity.course_activity_category==int(request.vars['category']))&(db.course_activity.semester==int(period.id))&(db.course_activity.assignation==int(project.id))&(db.course_activity.laboratory==True)).select()}}
			{{for rgrades_iterator in rgrades:}}
				{{for acrc in acrc_t:}}
					{{if rgrades_iterator.activity==acrc.id:}}
						{{validation_change=True}}
					{{pass}}
				{{pass}}
			{{pass}}
			{{if validation_change==False:}}
				{{functionAction=True}}
			{{else:}}
				{{if Draft!=None:}}
					{{db(db.requestchange_activity.id==Draft.id).delete()}}
				{{pass}}
				<script type="text/javascript">
					jQuery('#div_request_show').empty();
					alert("{{=T('You can not create a change request activity while there is a change request notes in an activity that is within the category to which you want to apply the changes.')}}");
					window.location.href = "{{=URL('activity_control', 'request_change_activity',vars=dict(project=project.id, year=period.id))}}";
				</script>
			{{pass}}
		{{pass}}
		{{if functionAction==True:}}
			{{if Draft==None:}}
				<script type="text/javascript">
					jQuery('#div_request_show').empty();
		            alert("{{=T('The change request activities in which you are working has been deleted by another user')}}");
		            window.location.href = "{{=URL('default', 'index')}}";
		        </script>
			{{else:}}
				{{if Draft.course_activity_category!=int(request.vars['category']):}}
					<script type="text/javascript">
						jQuery('#div_request_show').empty();
			            alert("{{=T('The change request activities in which you are working has been deleted by another user')}}");
			            window.location.href = "{{=URL('default', 'index')}}";
			        </script>
				{{else:}}
					{{
						from datetime import datetime
						date1=None
					    try:
					        date1 = datetime.strptime(request.vars['dateInit_var'], "%Y/%m/%d")
					    except:
					        try:
					        	date1 = datetime.strptime(request.vars['dateInit_var'], "%Y-%m-%d")
					        except:
					        	date1=None
					        pass
					    pass
					    if date1 is not None:
							dateInicialP = db.executesql('SELECT date(\''+request.vars['dateInit_var']+'\');',as_dict=True)
							for d0 in dateInicialP:
								date1=d0['date(\''+request.vars['dateInit_var']+'\')']
							pass
					    pass

					    #********************************************************************************
					    #********************************************************************************
					    #********************************************************************************
					    date2=None
					    try:
					        date2 = datetime.strptime(request.vars['dateEnd_var'], "%Y/%m/%d")
					    except:
					    	try:
					    		date2 = datetime.strptime(request.vars['dateEnd_var'], "%Y-%m-%d")
					    	except:
					        	date2=None
					        pass
					    pass
					    if date2 is not None:
					    	dateInicialP2 = db.executesql('SELECT date(\''+request.vars['dateEnd_var']+'\');',as_dict=True)
							for d0 in dateInicialP2:
								date2=d0['date(\''+request.vars['dateEnd_var']+'\')']
							pass
					    pass
					}}
					{{if date1==None or date2==None:}}
						<script type="text/javascript">
							alert("{{=T('One of the date or both are incorrect')}}"); 
						</script>
					{{else:}}
						{{actualSemester = db(db.period_year.id==request.vars['year']).select().first()}}
						{{comparacion = T(actualSemester.period.name)+" "+str(actualSemester.yearp)}}
						{{date_var = db((db.student_control_period.period_name==comparacion)).select().first()}}

						{{if date1>= date_var.date_start_semester and date2<= date_var.date_finish_semester:}}
							{{comprobation=False}}
							{{dateC1=None}}
							{{dateC2=None}}
							{{maximTimeCategory = db.executesql('SELECT DATE_ADD(\''+str(date1)+'\', INTERVAL '+str(cat.category.timeout)+' Day) as fecha;',as_dict=True)}}
							{{for d0 in maximTimeCategory:}}
								{{dateC1=d0['fecha']}}
							{{pass}}
							{{if str(date2)>str(dateC1):}}
								<script type="text/javascript"> 
									alert("{{=T('The maximum number of days of activities in this category is')}} {{=str(cat.category.timeout)}}"); 
								</script>
							{{else:}}
								{{maximTimeCategory = db.executesql('SELECT DATE_ADD(\''+str(date2)+'\', INTERVAL '+str(date_var.timeout_income_notes)+' Day) as fecha;',as_dict=True)}}
								{{for d0 in maximTimeCategory:}}
									{{dateC2=d0['fecha']}}
								{{pass}}
								{{if str(dateC2)>str(date_var.date_finish_semester):}}
									<script type="text/javascript"> 
										alert("{{=T('The end date of the activity over the time you have to enter notes exceeds timeout semester')}}"); 
									</script>
								{{else:}}
									{{comprobation=True}}
								{{pass}}
							{{pass}}

							{{if comprobation==True:}}
								{{changeActivities = db(db.requestchange_course_activity.requestchange_activity==Draft.id).select()}}
								{{tActivities = db((db.course_activity.semester==period.id)&(db.course_activity.assignation==project.id)&(db.course_activity.laboratory=='T')&(db.course_activity.course_activity_category==cat.id)).select()}}

								{{vecAct1=[]}}
								{{vecAct2=[]}}
								{{totalChanges=0}}
								<!--Activities that has change-->
								{{for c1 in changeActivities:}}
									{{if c1.operation_request=='insert':}}
										{{vecAct2.append(c1.name)}}
										{{vecAct2.append(c1.grade)}}
										{{vecAct1.append(vecAct2)}}
										{{vecAct2=[]}}
									{{else:}}
										{{totalChanges=totalChanges+1}}
									{{pass}}
								{{pass}}
								<!--Activities originals-->
								{{vecAct2=[]}}
								{{exist=0}}
								{{for c2 in tActivities:}}
									{{if totalChanges>0:}}
										{{for c1 in changeActivities:}}
											{{if c1.activity==c2.id:}}
												{{exist=1}}
												{{if c1.operation_request=='update':}}
													{{vecAct2.append(c1.name)}}
													{{vecAct2.append(c1.grade)}}
													{{vecAct1.append(vecAct2)}}
												{{pass}}
											{{pass}}
										{{pass}}
										{{if exist==0:}}
											{{vecAct2.append(c2.name)}}
											{{vecAct2.append(c2.grade)}}
											{{vecAct1.append(vecAct2)}}
										{{pass}}
									{{else:}}
										{{vecAct2.append(c2.name)}}
										{{vecAct2.append(c2.grade)}}
										{{vecAct1.append(vecAct2)}}
									{{pass}}
									{{vecAct2=[]}}
									{{exist=0}}
								{{pass}}
								

								<!--Check-->
								{{existName='false'}}
								{{total_var2=float(request.vars['field_grade_var'])}}
								{{for a1 in vecAct1:}}
									{{if a1[0] == request.vars['activity_name1_var']:}}
										{{existName='true'}}
									{{pass}}
									{{total_var2=total_var2+float(a1[1])}}
								{{pass}}

								{{if existName=='false':}}
									{{if cat.specific_grade==True:}}
										{{if float(total_var2)<=float(cat.grade):}}
											{{db.requestchange_course_activity.insert(requestchange_activity=Draft.id, operation_request = 'insert', name=request.vars['activity_name1_var'], description = request.vars['activity_description_var'], grade = request.vars['field_grade_var'], date_start = request.vars['dateInit_var'], date_finish=request.vars['dateEnd_var'])}}
										{{else:}}
											<script type="text/javascript"> 
												alert("{{=T('The sum of the ratings of the activities exceeds the limit of the category') }}  ({{=str(total_var2)}} / {{=str(cat.grade)}})"); 
											</script>
										{{pass}}
									{{else:}}
										{{db.requestchange_course_activity.insert(requestchange_activity=Draft.id, operation_request = 'insert', name=request.vars['activity_name1_var'], description = request.vars['activity_description_var'], grade = float(0), date_start = request.vars['dateInit_var'], date_finish=request.vars['dateEnd_var'])}}
									{{pass}}
								{{else:}}
									<script type="text/javascript"> 
										alert("{{=T('the name of the registered activity already exists.')}}"); 
									</script>
								{{pass}}

							{{pass}}
						{{else:}}
							<script type="text/javascript"> 
								alert("{{=T('The date range of activities are not within the range of the semester')}} ({{=date_var.date_start_semester}} - {{=date_var.date_finish_semester}})"); 
							</script>
						{{pass}}
					{{pass}}
				{{pass}}
			{{pass}}
		{{pass}}
	{{pass}}
{{pass}}


<!--DELETE ACTIVITY-->
{{if request.vars['op'] == "removeActivityL":}}
	{{weighting = db((db.request_change_weighting.status=='pending')&(db.request_change_weighting.project==request.vars['project'])).select().first()}}
	{{if weighting!=None:}}
		{{if Draft!=None:}}
			{{db(db.requestchange_activity.id==Draft.id).delete()}}
		{{pass}}
		<script type="text/javascript">
			jQuery('#div_request_show').empty();
			alert("{{=T('You can not create a change request activity since there is a change request weighting is not answered.')}}");
			window.location.href = "{{=URL('activity_control', 'request_change_activity',vars=dict(project=project.id, year=period.id))}}";
		</script>
	{{else:}}
		{{functionAction=False}}
		{{rgrades = db((db.request_change_grades.status=='pending')&(db.request_change_grades.period==int(period.id))&(db.request_change_grades.project==int(project.id))).select()}}
		{{if rgrades.first()==None:}}
			{{functionAction=True}}
		{{else:}}
			{{validation_change=False}}
			{{acrc_t = db((db.course_activity.course_activity_category==int(request.vars['category']))&(db.course_activity.semester==int(period.id))&(db.course_activity.assignation==int(project.id))&(db.course_activity.laboratory==True)).select()}}
			{{for rgrades_iterator in rgrades:}}
				{{for acrc in acrc_t:}}
					{{if rgrades_iterator.activity==acrc.id:}}
						{{validation_change=True}}
					{{pass}}
				{{pass}}
			{{pass}}
			{{if validation_change==False:}}
				{{functionAction=True}}
			{{else:}}
				{{if Draft!=None:}}
					{{db(db.requestchange_activity.id==Draft.id).delete()}}
				{{pass}}
				<script type="text/javascript">
					jQuery('#div_request_show').empty();
					alert("{{=T('You can not create a change request activity while there is a change request notes in an activity that is within the category to which you want to apply the changes.')}}");
					window.location.href = "{{=URL('activity_control', 'request_change_activity',vars=dict(project=project.id, year=period.id))}}";
				</script>
			{{pass}}
		{{pass}}
		{{if functionAction==True:}}
			{{if Draft==None:}}
				<script type="text/javascript">
					jQuery('#div_request_show').empty();
		            alert("{{=T('The change request activities in which you are working has been deleted by another user')}}");
		            window.location.href = "{{=URL('default', 'index')}}";
		        </script>
			{{else:}}
				{{if Draft.course_activity_category!=int(request.vars['category']):}}
					<script type="text/javascript">
						jQuery('#div_request_show').empty();
			            alert("{{=T('The change request activities in which you are working has been deleted by another user')}}");
			            window.location.href = "{{=URL('default', 'index')}}";
			        </script>
				{{else:}}
					{{if request.vars['var_id'] == "0":}}
						{{db((db.requestchange_course_activity.name==request.vars['var_name'])&(db.requestchange_course_activity.activity==None)&(db.requestchange_course_activity.requestchange_activity==Draft.id)).delete()}}
					{{else:}}
						{{activity_var = db(db.course_activity.id == request.vars['var_id']).select().first()}}
						{{var_act = db(db.grades.activity == request.vars['var_id']).select().first()}}
						{{if var_act != None:}} 
							<script type="text/javascript">
								alert("{{=T('Unable to delete activity because it already has some grade associated')}}"); 
							</script>
						{{else:}}
							{{actTemp = db((db.requestchange_course_activity.name==request.vars['var_name'])&(db.requestchange_course_activity.activity==request.vars['var_id'])&(db.requestchange_course_activity.requestchange_activity==Draft.id)).select().first()}}
							{{if actTemp==None:}}
								{{db.requestchange_course_activity.insert(requestchange_activity=Draft.id, operation_request = 'delete', name=activity_var.name, description = activity_var.description, grade = activity_var.grade, date_start = activity_var.date_start, date_finish=activity_var.date_finish,activity=activity_var.id)}}
							{{else:}}
								{{db(db.requestchange_course_activity.id==actTemp.id).update(operation_request='delete')}}
							{{pass}}
						{{pass}}
					{{pass}}
				{{pass}}
			{{pass}}
		{{pass}}
	{{pass}}
{{pass}}





<!--******************************************************************************************************************-->
<!--******************************************************************************************************************-->
<!--******************************************************************************************************************-->
<!--******************************************************************************************************************-->
<!--******************************************************************************************************************-->


{{if request.vars['op'] == "createRequest":}}
	{{weighting = db((db.request_change_weighting.status=='pending')&(db.request_change_weighting.project==request.vars['project'])).select().first()}}
	{{if weighting==None:}}
		{{functionAction=False}}
		{{rgrades = db((db.request_change_grades.status=='pending')&(db.request_change_grades.period==int(period.id))&(db.request_change_grades.project==int(project.id))).select()}}
		{{if rgrades.first()==None:}}
			{{functionAction=True}}
		{{else:}}
			{{if Draft!=None:}}
				{{validation_change=False}}
				{{acrc_t = db((db.course_activity.course_activity_category==int(Draft.course_activity_category))&(db.course_activity.semester==int(period.id))&(db.course_activity.assignation==int(project.id))&(db.course_activity.laboratory==True)).select()}}
				{{for rgrades_iterator in rgrades:}}
					{{for acrc in acrc_t:}}
						{{if rgrades_iterator.activity==acrc.id:}}
							{{validation_change=True}}
						{{pass}}
					{{pass}}
				{{pass}}
				{{if validation_change==False:}}
					{{functionAction=True}}
				{{else:}}
					{{if Draft!=None:}}
						{{db(db.requestchange_activity.id==Draft.id).delete()}}
					{{pass}}
					<H1>{{=T('You can not create a change request activity while there is a change request notes in an activity that is within the category to which you want to apply the changes.')}} </H1>
				{{pass}}
			{{else:}}
				{{functionAction=True}}
			{{pass}}
		{{pass}}
		{{if functionAction==True:}}
			{{if Draft==None:}}
				{{if totalCategories>0:}}
					<table>
						<tr>
							<td colspan="2"><center>{{=T('Category')}}</center></td>
						</tr>
						<tr>
							<td>
								<select class="generic-widget" id="categoryID" style="width:140px;">
								{{for category in categories:}}
										<option value="{{=category.id}}">{{=category.category.category}}</option>
								{{pass}}
								</select>
							</td>
							<td>
								<a id="loadActivity" role="button" class="btn btn-warning" title="{{=T('Load Category')}}" onclick="showCategory();"> 
						            {{=T('Load Category')}}
								</a>
							</td>
						</tr>
					</table>
				{{else:}}
					<H1>{{=T('No categories for the change request')}}</H1>
				{{pass}}
			{{else:}}
				<table>
					<tr>
						<td colspan="2"><center>{{=T('There is a change request activities in draft state')}}</center></td>
					</tr>
					<tr>
						<td colspan="2"><center>{{=T('Category')}}: {{=Draft.course_activity_category.category.category}}</center></td>
					</tr>
					<tr>
						<td colspan="2"><center>{{=T('User Creator')}}: {{=Draft.user_id.first_name}} {{=Draft.user_id.last_name}}</center></td>
					</tr>
					<tr>
						<td><center>
							<a class="btn btn-success" title="{{=T('Continue to request changes')}}" id="botonContinueRequest" onclick="createRequestChange();">
								{{=T('Continue request')}}
							</a>
						</center></td>
						<td><center>
							<a class="btn btn-danger" title="{{=T('Cancel the change request')}}" href="{{=URL('activity_control', 'requestchangeactivity/cancelR', vars=dict(project=project.id, year=period.id))}}">
								{{=T('Cancel request')}}
							</a>
						</center></td>
					</tr>
				</table>
				<script type="text/javascript">
					createRequest=1;
					category={{=int(Draft.course_activity_category)}};
				</script>
			{{pass}}
		{{pass}}
	{{else:}}
		{{if Draft!=None:}}
			{{db(db.requestchange_activity.id==Draft.id).delete()}}
		{{pass}}
		<H1>{{=T('You can not create a change request activity since there is a change request weighting is not answered.')}} </H1>
	{{pass}}
{{pass}}



{{if request.vars['op'] == "showRequest":}}
	{{weighting = db((db.request_change_weighting.status=='pending')&(db.request_change_weighting.project==request.vars['project'])).select().first()}}
	{{if weighting!=None:}}
		{{if Draft!=None:}}
			{{db(db.requestchange_activity.id==Draft.id).delete()}}
		{{pass}}
		<script type="text/javascript">
			jQuery('#div_request_show').empty();
			alert("{{=T('You can not create a change request activity since there is a change request weighting is not answered.')}}");
			window.location.href = "{{=URL('activity_control', 'request_change_activity',vars=dict(project=project.id, year=period.id))}}";
		</script>
	{{else:}}
		{{functionAction=False}}
		{{rgrades = db((db.request_change_grades.status=='pending')&(db.request_change_grades.period==int(period.id))&(db.request_change_grades.project==int(project.id))).select()}}
		{{if rgrades.first()==None:}}
			{{functionAction=True}}
		{{else:}}
			{{validation_change=False}}
			{{acrc_t = db((db.course_activity.course_activity_category==int(request.vars['category']))&(db.course_activity.semester==int(period.id))&(db.course_activity.assignation==int(project.id))&(db.course_activity.laboratory==True)).select()}}
			{{for rgrades_iterator in rgrades:}}
				{{for acrc in acrc_t:}}
					{{if rgrades_iterator.activity==acrc.id:}}
						{{validation_change=True}}
					{{pass}}
				{{pass}}
			{{pass}}
			{{if validation_change==False:}}
				{{functionAction=True}}
			{{else:}}
				{{if Draft!=None:}}
					{{db(db.requestchange_activity.id==Draft.id).delete()}}
				{{pass}}
				<script type="text/javascript">
					jQuery('#div_request_show').empty();
					alert("{{=T('You can not create a change request activity while there is a change request notes in an activity that is within the category to which you want to apply the changes.')}}");
					window.location.href = "{{=URL('activity_control', 'request_change_activity',vars=dict(project=project.id, year=period.id))}}";
				</script>
			{{pass}}
		{{pass}}
		{{if functionAction==True:}}
			{{if Draft==None:}}
				<script type="text/javascript">
					jQuery('#div_request_show').empty();
		            alert("{{=T('The change request activities in which you are working has been deleted by another user')}}");
		            window.location.href = "{{=URL('default', 'index')}}";
		        </script>
			{{else:}}
				{{if Draft.course_activity_category!=int(request.vars['category']):}}
					<script type="text/javascript">
						jQuery('#div_request_show').empty();
			            alert("{{=T('The change request activities in which you are working has been deleted by another user')}}");
			            window.location.href = "{{=URL('default', 'index')}}";
			        </script>
				{{else:}}
					{{tActivities = db((db.course_activity.semester==period.id)&(db.course_activity.assignation==project.id)&(db.course_activity.laboratory=='T')&(db.course_activity.course_activity_category==cat.id)).select()}}
					{{changeActivities=None}}
					{{if Draft!=None:}}
						{{changeActivities = db(db.requestchange_course_activity.requestchange_activity==Draft.id).select()}}
					{{pass}}
					<div align="left">
						<table>
							<tr>
								<td align="left">
									<div style="overflow:auto; width:100%;">
										
									</div>
								</td>
								<td>
									&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
								</td>
								<td align="right">
									<div style="overflow:auto; width:100%;" align="right">
										<table>
											<tr>
												<td>
										 		<span class="label label-success">&nbsp;&nbsp;&nbsp;</span>&nbsp;{{=T('Activities added')}}
										 		</td>
										 		<td>
										 		<span class="label label-info">&nbsp;&nbsp;&nbsp;</span>&nbsp;{{=T('Activities to date')}}
										 		</td>
										 		<td>
										 		<span class="label label-important">&nbsp;&nbsp;&nbsp;</span>&nbsp;{{=T('Eliminated activities')}}
										 		</td>
										 		<td>
										 		<span class="label">&nbsp;&nbsp;&nbsp;</span>&nbsp;{{=T('Normal activities')}}
										 		</td>
										 	</tr>
										</table>
									</div>
								</td>
							</tr>
						</table>
					</div>
					<table>
						<tr>
							<td align="left">
								<div class="well span11" id="div_requestChange" style="overflow:auto; width:100%;">
									<label>{{=T('Description')}}</label>
									<textarea class="string" cols="40" type="text" value="" id="activity_description_request" style="width:280px; height:100px;"></textarea>
									{{totalChanges=0}}
									{{if changeActivities!=None:}}
										{{for change in changeActivities:}}
											{{totalChanges=totalChanges+1}}
										{{pass}}
									{{pass}}
									<label>{{=T('Total Changes')}}: {{=totalChanges}}</label>
									<table class="table table-bordered">
										<tr>
											<th>{{=T('Category')}}</th>
											<th>{{=T('Detail')}}</th>
										</tr>
										{{totalControl=0}}
										{{exist=0}}
										{{for act in tActivities:}}
											{{if totalChanges==0:}}
												{{if cat.specific_grade==True:}}
													{{totalControl=totalControl+act.grade}}
												{{else:}}
													{{totalControl=totalControl+1}}
												{{pass}}
											{{else:}}
												{{for change in changeActivities:}}
													{{if act.id==change.activity:}}
														{{exist=1}}
														{{if change.operation_request!='delete':}}
															{{if cat.specific_grade==True:}}
																{{totalControl=totalControl+change.grade}}
															{{else:}}
																{{totalControl=totalControl+1}}
															{{pass}}
														{{pass}}
													{{pass}}
												{{pass}}
												{{if exist==0:}}
													{{if cat.specific_grade==True:}}
														{{totalControl=totalControl+act.grade}}
													{{else:}}
														{{totalControl=totalControl+1}}
													{{pass}}
												{{pass}}
												{{exist=0}}
											{{pass}}
										{{pass}}
										{{if changeActivities!=None:}}
											{{for change in changeActivities:}}
												{{if change.operation_request=='insert':}}
													{{if cat.specific_grade==True:}}
														{{totalControl=totalControl+change.grade}}
													{{else:}}
														{{totalControl=totalControl+1}}
													{{pass}}
												{{pass}}
											{{pass}}
										{{pass}}
										<tr>
											{{if cat.specific_grade==True:}}
												{{if totalControl==cat.grade:}}
													<td><FONT COLOR="Blue">{{=cat.category.category}}</font></td><td><FONT COLOR="Blue">---</font></td>
												{{else:}}
													<td><FONT COLOR="Red">{{=cat.category.category}}</font></td><td><FONT COLOR="Red">PonderaciÃ³n Erronea: {{=totalControl}}/{{=cat.grade}}</font></td>
												{{pass}}
											{{else:}}
												{{if totalControl==0:}}
													<td><FONT COLOR="Red">{{=cat.category.category}}</font></td><td><FONT COLOR="Red">No tiene actividades</font></td>
												{{else:}}
													<td><FONT COLOR="Blue">{{=cat.category.category}}</font></td><td><FONT COLOR="Blue">---</font></td>
												{{pass}}
											{{pass}}
										</tr>
									</table>
									<center>
									{{if totalChanges>0 and ((cat.specific_grade==True and totalControl==cat.grade) or (cat.specific_grade==False and totalControl>0)):}}
										
										<a class="btn btn-success" title="{{=T('Make the change requestt')}}" id="botonRequest" onclick="makeRequest(1);">
											{{=T('Make request')}}
										</a>
									{{else:}}
										<a class="btn disabled" title="{{=T('Make the change requestt')}}" id="botonRequest" onclick="makeRequest(0);">
											{{=T('Make request')}}
										</a>
									{{pass}}
									<a class="btn btn-danger" title="{{=T('Cancel the change request')}}" href="{{=URL('activity_control', 'requestchangeactivity/cancelR', vars=dict(project=project.id, year=period.id))}}">
										{{=T('Cancel request')}}
									</a>
									</center>
								</div>
							</td>
							<td align="left">
								<div class="well span11" id="div_activity_show"  style="overflow:auto; width:100%;">
				    				<table class="table table-striped table-bordered">
				    					<tr><th colspan="5"><center>{{=cat.category.category}} ({{=cat.grade}} pts)</center></th></tr>
				    					<tr><th>Nombre</th><th>DescripciÃ³n</th><th>Punteo</th><th>Fecha Inicio</th><th>Fecha FinalizaciÃ³n</th></tr>
					    				{{exist=0}}
					    				{{for act in tActivities:}}
					    					<tr>
											{{if totalChanges==0:}}
												<td>{{=act.name}}</td>
												<td>
													<div style="width:200px;">
														{{=act.description[:100]}}
														{{if len(act.description) > 100:}}...
															<br>
															<div align="right">
																<a type="button" style ="cursor:pointer;" role="button" data-toggle="modal" data-target="#des_ShowR_modal_{{=act.id}}_{{=act.name}}" >{{=T('View more')}}</span></a>
															</div>
													
															<!--MODAL -->
															<div id="des_ShowR_modal_{{=act.id}}_{{=act.name}}" class="modal hide fade" tabindex="-1" role="dialog"  aria-hidden="true"> 
															  <div class="modal-header">
															    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
															      <h3 id="myModalLabel">
															          {{=act.name}}
															      </h3>
															  </div>
															  <div class="modal-body">
															    <div class="well">
															        <pre>
															           {{=act.description}}
															        </pre>
															    </div>
															  </div>
															  <div class="modal-footer">
															      <button class="btn" data-dismiss="modal" aria-hidden="true">{{=T('Close')}}</button>
															  </div>
															</div>
															<!--Finish MODaL-->
														{{pass}}
													</div>
												</td>
												<td>
													{{if act.grade == float(0):}}
														<label style ="cursor:help;" title="{{=T('The grade of')}} '{{=cat.category.category}}' {{=T('is averaged.')}}">
															{{=T('AG')}}
														</label>
													{{else:}}
														{{=act.grade}}
													{{pass}}
												</td>
												<td>{{=act.date_start}}</td>
												<td>{{=act.date_finish}}</td>
											{{else:}}
												{{for change in changeActivities:}}
													{{if act.id==change.activity:}}
														{{exist=1}}
														{{if change.operation_request=='delete':}}
															<td><FONT COLOR="Red">{{=act.name}}</font></td>
															<td><FONT COLOR="Red">
																<div style="width:200px;">
																	{{=act.description[:100]}}
																	{{if len(act.description) > 100:}}...
																		<br>
																		<div align="right">
																			<a type="button" style ="cursor:pointer;" role="button" data-toggle="modal" data-target="#des_ShowR_modal_{{=act.id}}_{{=act.name}}" >{{=T('View more')}}</span></a>
																		</div>
																
																		<!--MODAL -->
																		<div id="des_ShowR_modal_{{=act.id}}_{{=act.name}}" class="modal hide fade" tabindex="-1" role="dialog"  aria-hidden="true"> 
																		  <div class="modal-header">
																		    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
																		      <h3 id="myModalLabel">
																		          {{=act.name}}
																		      </h3>
																		  </div>
																		  <div class="modal-body">
																		    <div class="well">
																		        <pre>
																		           {{=act.description}}
																		        </pre>
																		    </div>
																		  </div>
																		  <div class="modal-footer">
																		      <button class="btn" data-dismiss="modal" aria-hidden="true">{{=T('Close')}}</button>
																		  </div>
																		</div>
																		<!--Finish MODaL-->
																	{{pass}}
																</div>
															</font></td>
															<td><FONT COLOR="Red">
																{{if act.grade == float(0):}}
																	<label style ="cursor:help;" title="{{=T('The grade of')}} '{{=cat.category.category}}' {{=T('is averaged.')}}">
																		{{=T('AG')}}
																	</label>
																{{else:}}
																	{{=act.grade}}
																{{pass}}
															</font></td>
															<td><FONT COLOR="Red">{{=act.date_start}}</font></td>
															<td><FONT COLOR="Red">{{=act.date_finish}}</font></td>
														{{else:}}
															<td><FONT COLOR="Blue">{{=change.name}}</font></td>
															<td><FONT COLOR="Blue">
																<div style="width:200px;">
																	{{=change.description[:100]}}
																	{{if len(change.description) > 100:}}...
																		<br>
																		<div align="right">
																			<a type="button" style ="cursor:pointer;" role="button" data-toggle="modal" data-target="#des_ShowR_modal_{{=change.id}}_{{=change.name}}" >{{=T('View more')}}</span></a>
																		</div>
																
																		<!--MODAL -->
																		<div id="des_ShowR_modal_{{=change.id}}_{{=change.name}}" class="modal hide fade" tabindex="-1" role="dialog"  aria-hidden="true"> 
																		  <div class="modal-header">
																		    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
																		      <h3 id="myModalLabel">
																		          {{=change.name}}
																		      </h3>
																		  </div>
																		  <div class="modal-body">
																		    <div class="well">
																		        <pre>
																		           {{=change.description}}
																		        </pre>
																		    </div>
																		  </div>
																		  <div class="modal-footer">
																		      <button class="btn" data-dismiss="modal" aria-hidden="true">{{=T('Close')}}</button>
																		  </div>
																		</div>
																		<!--Finish MODaL-->
																	{{pass}}
																</div>
															</font></td>
															<td><FONT COLOR="Blue">
																{{if change.grade == float(0):}}
																	<label style ="cursor:help;" title="{{=T('The grade of')}} '{{=cat.category.category}}' {{=T('is averaged.')}}">
																		{{=T('AG')}}
																	</label>
																{{else:}}
																	{{=change.grade}}
																{{pass}}
															</font></td>
															<td><FONT COLOR="Blue">{{=change.date_start}}</font></td>
															<td><FONT COLOR="Blue">{{=change.date_finish}}</font></td>
														{{pass}}
													{{pass}}
												{{pass}}
												{{if exist==0:}}
													<td>{{=act.name}}</td>
													<td>
														<div style="width:200px;">
															{{=act.description[:100]}}
															{{if len(act.description) > 100:}}...
																<br>
																<div align="right">
																	<a type="button" style ="cursor:pointer;" role="button" data-toggle="modal" data-target="#des_ShowR_modal_{{=act.id}}_{{=act.name}}" >{{=T('View more')}}</span></a>
																</div>
														
																<!--MODAL -->
																<div id="des_ShowR_modal_{{=act.id}}_{{=act.name}}" class="modal hide fade" tabindex="-1" role="dialog"  aria-hidden="true"> 
																  <div class="modal-header">
																    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
																      <h3 id="myModalLabel">
																          {{=act.name}}
																      </h3>
																  </div>
																  <div class="modal-body">
																    <div class="well">
																        <pre>
																           {{=act.description}}
																        </pre>
																    </div>
																  </div>
																  <div class="modal-footer">
																      <button class="btn" data-dismiss="modal" aria-hidden="true">{{=T('Close')}}</button>
																  </div>
																</div>
																<!--Finish MODaL-->
															{{pass}}
														</div>
													</td>
													<td>
														{{if act.grade == float(0):}}
															<label style ="cursor:help;" title="{{=T('The grade of')}} '{{=cat.category.category}}' {{=T('is averaged.')}}">
																{{=T('AG')}}
															</label>
														{{else:}}
															{{=act.grade}}
														{{pass}}
													</td>
													<td>{{=act.date_start}}</td>
													<td>{{=act.date_finish}}</td>
												{{pass}}
												{{exist=0}}
											{{pass}}
											</tr>
										{{pass}}
										{{if totalChanges>0:}}
											{{for change in changeActivities:}}
												{{if change.operation_request=='insert':}}
													<tr>
														<td><FONT COLOR="Green">{{=change.name}}</font></td>
														<td><FONT COLOR="Green">
															<div style="width:200px;">
																{{=change.description[:100]}}
																{{if len(change.description) > 100:}}...
																	<br>
																	<div align="right">
																		<a type="button" style ="cursor:pointer;" role="button" data-toggle="modal" data-target="#des_ShowR_modal_{{=change.id}}_{{=change.name}}" >{{=T('View more')}}</span></a>
																	</div>
															
																	<!--MODAL -->
																	<div id="des_ShowR_modal_{{=change.id}}_{{=change.name}}" class="modal hide fade" tabindex="-1" role="dialog"  aria-hidden="true"> 
																	  <div class="modal-header">
																	    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
																	      <h3 id="myModalLabel">
																	          {{=change.name}}
																	      </h3>
																	  </div>
																	  <div class="modal-body">
																	    <div class="well">
																	        <pre>
																	           {{=change.description}}
																	        </pre>
																	    </div>
																	  </div>
																	  <div class="modal-footer">
																	      <button class="btn" data-dismiss="modal" aria-hidden="true">{{=T('Close')}}</button>
																	  </div>
																	</div>
																	<!--Finish MODaL-->
																{{pass}}
															</div>
														</font></td>
														<td><FONT COLOR="Green">
															{{if change.grade == float(0):}}
																<label style ="cursor:help;" title="{{=T('The grade of')}} '{{=cat.category.category}}' {{=T('is averaged.')}}">
																	{{=T('AG')}}
																</label>
															{{else:}}
																{{=change.grade}}
															{{pass}}
														</font></td>
														<td><FONT COLOR="Green">{{=change.date_start}}</font></td>
														<td><FONT COLOR="Green">{{=change.date_finish}}</font></td>
													</tr>
												{{pass}}
											{{pass}}
										{{pass}}
									</table>
				              	</div>
							</td>
						</tr>
					</table>
					<div align="left">
						<a role="button" class="btn btn-warning" title="{{=T('Edit the change request')}}" onclick="controlActivities();"> 
							<span class="icon-arrow-left"></span>
					        {{=T('Edit request')}}
						</a>
					</div>
				{{pass}}
			{{pass}}
		{{pass}}
	{{pass}}
{{pass}}





{{if request.vars['op'] == "addActivities" or request.vars['op'] == "controlActivities" or request.vars['op'] == "removeActivityL" or request.vars['op'] == "createActivity" or request.vars['op'] == "showEditActivity" or request.vars['op'] == "updateActivity":}}
	{{weighting = db((db.request_change_weighting.status=='pending')&(db.request_change_weighting.project==request.vars['project'])).select().first()}}
	{{if weighting!=None:}}
		{{if Draft!=None:}}
			{{db(db.requestchange_activity.id==Draft.id).delete()}}
		{{pass}}
		<script type="text/javascript">
			jQuery('#div_request_show').empty();
			alert("{{=T('You can not create a change request activity since there is a change request weighting is not answered.')}}");
			window.location.href = "{{=URL('activity_control', 'request_change_activity',vars=dict(project=project.id, year=period.id))}}";
		</script>
	{{else:}}
		{{functionAction=False}}
		{{rgrades = db((db.request_change_grades.status=='pending')&(db.request_change_grades.period==int(period.id))&(db.request_change_grades.project==int(project.id))).select()}}
		{{if rgrades.first()==None:}}
			{{functionAction=True}}
		{{else:}}
			{{validation_change=False}}
			{{acrc_t = db((db.course_activity.course_activity_category==int(request.vars['category']))&(db.course_activity.semester==int(period.id))&(db.course_activity.assignation==int(project.id))&(db.course_activity.laboratory==True)).select()}}
			{{for rgrades_iterator in rgrades:}}
				{{for acrc in acrc_t:}}
					{{if rgrades_iterator.activity==acrc.id:}}
						{{validation_change=True}}
					{{pass}}
				{{pass}}
			{{pass}}
			{{if validation_change==False:}}
				{{functionAction=True}}
			{{else:}}
				{{if Draft!=None:}}
					{{db(db.requestchange_activity.id==Draft.id).delete()}}
				{{pass}}
				<script type="text/javascript">
					jQuery('#div_request_show').empty();
					alert("{{=T('You can not create a change request activity while there is a change request notes in an activity that is within the category to which you want to apply the changes.')}}");
					window.location.href = "{{=URL('activity_control', 'request_change_activity',vars=dict(project=project.id, year=period.id))}}";
				</script>
			{{pass}}
		{{pass}}
		{{if functionAction==True:}}
			{{if Draft==None:}}
				<script type="text/javascript">
					jQuery('#div_request_show').empty();
		            alert("{{=T('The change request activities in which you are working has been deleted by another user')}}");
		            window.location.href = "{{=URL('default', 'index')}}";
		        </script>
			{{else:}}
				{{if Draft.course_activity_category!=int(request.vars['category']):}}
					<script type="text/javascript">
						jQuery('#div_request_show').empty();
			            alert("{{=T('The change request activities in which you are working has been deleted by another user')}}");
			            window.location.href = "{{=URL('default', 'index')}}";
			        </script>
				{{else:}}
				<div >
					<table>
						<tr>
							<td align="left">
								<div style="overflow:auto; width:100%;">
									<table>
										<tr>
									 		<td>
									 		<span class="label label-success">&nbsp;&nbsp;&nbsp;</span>&nbsp;{{=T('Activities added')}}
									 		</td>
									 		<td>
									 		<span class="label label-info">&nbsp;&nbsp;&nbsp;</span>&nbsp;{{=T('Activities to date')}}
									 		</td>
									 		<td>
									 		<span class="label">&nbsp;&nbsp;&nbsp;</span>&nbsp;{{=T('Normal activities')}}
									 		</td>
									 	</tr>
									</table>
								</div>
							</td>
							<td align="right">
								
							</td>
						</tr>
					</table>
				</div>
					<table>
						<tr>
							<td align="left">
								<div class="well span11" id="div_requestChange" style="overflow:auto; width:100%;">
									<label id="{{=cat.id}}">{{=cat.category.category}} ({{=cat.grade}} pts.)</label>
									<label>{{=T('name')}}:</label>
									{{if cat.category.category=='Examen Final':}}
										<input class="string" type="text" id="activity_name1" style="width:200px;" value="Examen Final" disabled>
									{{elif cat.category.category=='Parciales':}}
										<select class="generic-widget" id="activity_name1" style="width:200px;">
											<option value="Primer Parcial">Primer Parcial</option>
											<option value="Segundo Parcial">Segundo Parcial</option>
											<option value="Tercer Parcial">Tercer Parcial</option>
										</select>
									{{else:}}
										<input class="string" type="text" value="" id="activity_name1" style="width:200px;">
									{{pass}}
									<label>{{=T('description')}}:</label>
								    <textarea class="string" cols="40" type="text" value="" id="activity_description" style="width:200px; height:100px;"></textarea>
								    {{if cat.specific_grade==True:}}
								    	<label id="label_grade">{{=T('Grade')}}:</label>
								    	{{if cat.category.category=='Examen Final':}}
								    		<input class="string" id="field_grade" type="text" value="{{=cat.grade}}" style="width:200px;" disabled>
								    	{{else:}}
								    		<input class="string" id="field_grade" type="text" value="" style="width:200px;">
								    	{{pass}}
								    {{else:}}
								    	<input class="string" id="field_grade" type="text" value="1" style="width:200px; display:none;">
								    {{pass}}
								    <br>
								    <FONT COLOR="Red"><b>{{=T('Maximum days of activity:')}} {{=cat.category.timeout}}</b></font>&nbsp;&nbsp;<a type="button" title="{{=T('Help')}}" aria-hidden="true" role="button" data-toggle="modal" data-target="#help_modal_request_change_activity" ><span class="icon-black icon-question-sign"></span></a>
								    <label>{{=T('Start Date')}}:</label>
								    <input class="date" id="dateInit" name="log-date" placeholder="YYYY-MM-DD" type="text" value = "" style="width:200px;">
								    <label>{{=T('End Date')}}:</label>
								    <input class="date" id="dateEnd" name="log-date" placeholder="YYYY-MM-DD" type="text" value = "" style="width:200px;">
								    <br>
								    <a id="addActivity" role="button" class="btn btn-success" title="{{=T('Add activity to scheduler')}}" onclick="createActivity();"> 
								        <span class="icon-plus-sign"></span>
								        {{=T('Add Activity')}}
									</a>
								</div>
							</td>
							<td align="left">
								<div class="well span11" id="div_activity_show"  style="overflow:auto; width:100%;">
									{{tActivities = db((db.course_activity.semester==period.id)&(db.course_activity.assignation==project.id)&(db.course_activity.laboratory=='T')&(db.course_activity.course_activity_category==cat.id)).select()}}
									{{changeActivities=None}}
									{{if Draft!=None:}}
										{{changeActivities = db(db.requestchange_course_activity.requestchange_activity==Draft.id).select()}}
									{{pass}}

									{{totalChanges=0}}
									{{if changeActivities!=None:}}
										{{for change in changeActivities:}}
											{{totalChanges=totalChanges+1}}
										{{pass}}
									{{pass}}
									<table class="table table-striped table-bordered">
										<tr><th colspan="6"><center>{{=cat.category.category}} ({{=cat.grade}} pts)</center>
										</th></tr>
										<tr><th>Nombre</th><th>DescripciÃ³n</th><th>Punteo</th><th>Fecha Inicio</th><th>Fecha FinalizaciÃ³n</th><th>{{=T('Actions')}}</th>
										</tr>
										{{exist=0}}
										{{editable_var='false'}}
										{{for act in tActivities:}}
											{{editable_var='false'}}
											<tr>
											{{if totalChanges==0:}}
												{{if request.vars['op'] == "showEditActivity":}}
													{{if str(act.id)==request.vars['var_id'] and act.name==request.vars['var_name']:}}
														{{editable_var='true'}}
													{{pass}}
												{{pass}}
												{{if editable_var=='true':}}
													<td>
														{{if cat.category.category=='Examen Final':}}
															<input class="string" type="text" id="edit_activity_name1" style="width:140px;" value="Examen Final" disabled>
														{{elif act.name=='Primer Parcial' or act.name=='Segundo Parcial' or act.name=='Tercer Parcial':}}
															<select class="generic-widget" id="edit_activity_name1" style="width:140px;">
															{{if act.name=='Primer parcial':}}
																<option value="{{=act.name}}">{{=act.name}}</option>
																<option value="Segundo Parcial">Segundo Parcial</option>
																<option value="Tercer Parcial">Tercer Parcial</option>
															{{elif act.name=='Segundo parcial':}}
																<option value="Primer Parcial">Primer Parcial</option>
																<option value="{{=act.name}}">{{=act.name}}</option>
																<option value="Tercer Parcial">Tercer Parcial</option>
															{{else:}}
																<option value="Primer Parcial">Primer Parcial</option>
																<option value="Segundo Parcial">Segundo Parcial</option>
																<option value="{{=act.name}}">{{=act.name}}</option>
															{{pass}}
															</select>
														{{else:}}
															<input class="string" type="text" value="{{=act.name}}" id="edit_activity_name1" style="width:140px;">
														{{pass}}
													</td>
													<td>
														<textarea class="string" cols="40" type="text" id="edit_activity_description" style="width:200px; height:100px;">{{=act.description}}</textarea>
													</td>
													<td>
														{{if cat.specific_grade==True:}}
													    	{{if cat.category.category=='Examen Final':}}
													    		<input class="string" id="edit_field_grade" type="text" value="{{=act.grade}}" style="width:40px;" disabled>
													    	{{else:}}
													    		<input class="string" id="edit_field_grade" type="text" value="{{=act.grade}}" style="width:40px;">
													    	{{pass}}
													    {{else:}}
													    	<input class="string" id="edit_field_grade" type="text" value="{{=act.grade}}" style="width:40px;" disabled>
													    {{pass}}
													</td>
													<td>
													    <input class="date" id="edit_dateInit" name="log-date" placeholder="YYYY-MM-DD" type="text" value = "{{=act.date_start}}" style="width:100px;">
													</td>
													<td>
													    <input class="date" id="edit_dateEnd" name="log-date" placeholder="YYYY-MM-DD" type="text" value = "{{=act.date_finish}}" style="width:100px;">
													</td>
												{{else:}}
													<td>{{=act.name}}</td>
													<td>
														<div style="width:200px;">
															{{=act.description[:100]}}
															{{if len(act.description) > 100:}}...
																<br>
																<div align="right">
																	<a type="button" style ="cursor:pointer;" role="button" data-toggle="modal" data-target="#des_ShowC_modal_{{=act.id}}_{{=act.name}}" >{{=T('View more')}}</span></a>
																</div>
														
																<!--MODAL -->
																<div id="des_ShowC_modal_{{=act.id}}_{{=act.name}}" class="modal hide fade" tabindex="-1" role="dialog"  aria-hidden="true"> 
																  <div class="modal-header">
																    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
																      <h3 id="myModalLabel">
																          {{=act.name}}
																      </h3>
																  </div>
																  <div class="modal-body">
																    <div class="well">
																        <pre>
																           {{=act.description}}
																        </pre>
																    </div>
																  </div>
																  <div class="modal-footer">
																      <button class="btn" data-dismiss="modal" aria-hidden="true">{{=T('Close')}}</button>
																  </div>
																</div>
																<!--Finish MODaL-->
															{{pass}}
														</div>
													</td>
													<td>
														{{if act.grade == float(0):}}
															<label style ="cursor:help;" title="{{=T('The grade of')}} '{{=cat.category.category}}' {{=T('is averaged.')}}">
																{{=T('AG')}}
															</label>
														{{else:}}
															{{=act.grade}}
														{{pass}}
													</td>
													<td>{{=act.date_start}}</td>
													<td>{{=act.date_finish}}</td>
												{{pass}}
												<td>
													<center>
														{{if editable_var=='true':}}
															<a id="activityButton" role="button" class="badge btn-success"  
															onclick="updateActivity({{=act.id}},'{{=act.name}}');"> 
									                    		<span class="icon-white icon-check"></span>
									                    	</a>
								                    	{{else:}}
								                    		<a id="activityButton" role="button" class="badge btn-info"  
															onclick="editActivity({{=act.id}},'{{=act.name}}');"> 
									                    		<span class="icon-white icon-edit"></span>
									                    	</a>
								                    	{{pass}}
								                    	<a id="activityButton" role="button" class="badge btn-danger" 
								                    	onclick="removeActivity({{=act.id}},'{{=act.name}}');"> 
								                    		<span class="icon-white icon-remove-sign"></span>
								                    	</a>
													</center>
												</td>
											{{else:}}
												{{for change in changeActivities:}}
													{{if act.id==change.activity:}}
														{{exist=1}}
														{{if change.operation_request=='update':}}
															{{if request.vars['op'] == "showEditActivity":}}
																{{if str(change.activity)==request.vars['var_id'] and change.name==request.vars['var_name']:}}
																	{{editable_var='true'}}
																{{pass}}
															{{pass}}
															{{if editable_var=='true':}}
																<td>
																	{{if cat.category.category=='Examen Final':}}
																		<input class="string" type="text" id="edit_activity_name1" style="width:140px;" value="Examen Final" disabled>
																	{{elif act.name=='Primer Parcial' or act.name=='Segundo Parcial' or act.name=='Tercer Parcial':}}
																		<select class="generic-widget" id="edit_activity_name1" style="width:140px;">
																		{{if act.name=='Primer parcial':}}
																			<option value="{{=act.name}}">{{=change.name}}</option>
																			<option value="Segundo Parcial">Segundo Parcial</option>
																			<option value="Tercer Parcial">Tercer Parcial</option>
																		{{elif act.name=='Segundo parcial':}}
																			<option value="Primer Parcial">Primer Parcial</option>
																			<option value="{{=act.name}}">{{=change.name}}</option>
																			<option value="Tercer Parcial">Tercer Parcial</option>
																		{{else:}}
																			<option value="Primer Parcial">Primer Parcial</option>
																			<option value="Segundo Parcial">Segundo Parcial</option>
																			<option value="{{=act.name}}">{{=change.name}}</option>
																		{{pass}}
																		</select>
																	{{else:}}
																		<input class="string" type="text" value="{{=change.name}}" id="edit_activity_name1" style="width:140px;">
																	{{pass}}
																</td>
																<td>
																	<textarea class="string" cols="40" type="text" id="edit_activity_description" style="width:200px; height:100px;">{{=change.description}}</textarea>
																</td>
																<td>
																	{{if cat.specific_grade==True:}}
																    	{{if cat.category.category=='Examen Final':}}
																    		<input class="string" id="edit_field_grade" type="text" value="{{=change.grade}}" style="width:40px;" disabled>
																    	{{else:}}
																    		<input class="string" id="edit_field_grade" type="text" value="{{=change.grade}}" style="width:40px;">
																    	{{pass}}
																    {{else:}}
																    	<input class="string" id="edit_field_grade" type="text" value="{{=change.grade}}" style="width:40px;" disabled>
																    {{pass}}
																</td>
																<td>
																    <input class="date" id="edit_dateInit" name="log-date" placeholder="YYYY-MM-DD" type="text" value = "{{=change.date_start}}" style="width:100px;">
																</td>
																<td>
																    <input class="date" id="edit_dateEnd" name="log-date" placeholder="YYYY-MM-DD" type="text" value = "{{=change.date_finish}}" style="width:100px;">
																</td>
															{{else:}}
																<td><FONT COLOR="Blue">{{=change.name}}</font></td>
																<td><FONT COLOR="Blue">
																	<div style="width:200px;">
																		{{=change.description[:100]}}
																		{{if len(change.description) > 100:}}...
																			<br>
																			<div align="right">
																				<a type="button" style ="cursor:pointer;" role="button" data-toggle="modal" data-target="#des_ShowC_modal_{{=change.id}}_{{=change.name}}" >{{=T('View more')}}</span></a>
																			</div>
																	
																			<!--MODAL -->
																			<div id="des_ShowC_modal_{{=change.id}}_{{=change.name}}" class="modal hide fade" tabindex="-1" role="dialog"  aria-hidden="true"> 
																			  <div class="modal-header">
																			    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
																			      <h3 id="myModalLabel">
																			          {{=change.name}}
																			      </h3>
																			  </div>
																			  <div class="modal-body">
																			    <div class="well">
																			        <pre>
																			           {{=change.description}}
																			        </pre>
																			    </div>
																			  </div>
																			  <div class="modal-footer">
																			      <button class="btn" data-dismiss="modal" aria-hidden="true">{{=T('Close')}}</button>
																			  </div>
																			</div>
																			<!--Finish MODaL-->
																		{{pass}}
																	</div>
																</font></td>
																<td><FONT COLOR="Blue">
																	{{if change.grade == float(0):}}
																		<label style ="cursor:help;" title="{{=T('The grade of')}} '{{=cat.category.category}}' {{=T('is averaged.')}}">
																			{{=T('AG')}}
																		</label>
																	{{else:}}
																		{{=change.grade}}
																	{{pass}}
																</font></td>
																<td><FONT COLOR="Blue">{{=change.date_start}}</font></td>
																<td><FONT COLOR="Blue">{{=change.date_finish}}</font></td>
															{{pass}}
															<td>
																<center>
																	{{if editable_var=='true':}}
																		<a id="activityButton" role="button" class="badge btn-success"  
																		onclick="updateActivity({{=change.activity}},'{{=change.name}}');"> 
												                    		<span class="icon-white icon-check"></span>
												                    	</a>
											                    	{{else:}}
											                    		<a id="activityButton" role="button" class="badge btn-info"  
																		onclick="editActivity({{=change.activity}},'{{=change.name}}');"> 
												                    		<span class="icon-white icon-edit"></span>
												                    	</a>
											                    	{{pass}}
											                    	<a id="activityButton" role="button" class="badge btn-danger" 
											                    	onclick="removeActivity({{=change.activity}},'{{=change.name}}');">
											                    		<span class="icon-white icon-remove-sign"></span>
											                    	</a>
																</center>
															</td>
														{{pass}}
													{{pass}}
												{{pass}}
												{{if exist==0:}}
													{{if request.vars['op'] == "showEditActivity":}}
														{{if str(act.id)==request.vars['var_id'] and act.name==request.vars['var_name']:}}
															{{editable_var='true'}}
														{{pass}}
													{{pass}}
													{{if editable_var=='true':}}
														<td>
															{{if cat.category.category=='Examen Final':}}
																<input class="string" type="text" id="edit_activity_name1" style="width:140px;" value="Examen Final" disabled>
															{{elif act.name=='Primer Parcial' or act.name=='Segundo Parcial' or act.name=='Tercer Parcial':}}
																<select class="generic-widget" id="edit_activity_name1" style="width:140px;">
																{{if act.name=='Primer parcial':}}
																	<option value="{{=act.name}}">{{=act.name}}</option>
																	<option value="Segundo Parcial">Segundo Parcial</option>
																	<option value="Tercer Parcial">Tercer Parcial</option>
																{{elif act.name=='Segundo parcial':}}
																	<option value="Primer Parcial">Primer Parcial</option>
																	<option value="{{=act.name}}">{{=act.name}}</option>
																	<option value="Tercer Parcial">Tercer Parcial</option>
																{{else:}}
																	<option value="Primer Parcial">Primer Parcial</option>
																	<option value="Segundo Parcial">Segundo Parcial</option>
																	<option value="{{=act.name}}">{{=act.name}}</option>
																{{pass}}
																</select>
															{{else:}}
																<input class="string" type="text" value="{{=act.name}}" id="edit_activity_name1" style="width:140px;">
															{{pass}}
														</td>
														<td>
															<textarea class="string" cols="40" type="text" id="edit_activity_description" style="width:200px; height:100px;">{{=act.description}}</textarea>
														</td>
														<td>
															{{if cat.specific_grade==True:}}
														    	{{if cat.category.category=='Examen Final':}}
														    		<input class="string" id="edit_field_grade" type="text" value="{{=act.grade}}" style="width:40px;" disabled>
														    	{{else:}}
														    		<input class="string" id="edit_field_grade" type="text" value="{{=act.grade}}" style="width:40px;">
														    	{{pass}}
														    {{else:}}
														    	<input class="string" id="edit_field_grade" type="text" value="{{=act.grade}}" style="width:40px;" disabled>
														    {{pass}}
														</td>
														<td>
														    <input class="date" id="edit_dateInit" name="log-date" placeholder="YYYY-MM-DD" type="text" value = "{{=act.date_start}}" style="width:100px;">
														</td>
														<td>
														    <input class="date" id="edit_dateEnd" name="log-date" placeholder="YYYY-MM-DD" type="text" value = "{{=act.date_finish}}" style="width:100px;">
														</td>
													{{else:}}
														<td>{{=act.name}}</td>
														<td>
															<div style="width:200px;">
																{{=act.description[:100]}}
																{{if len(act.description) > 100:}}...
																	<br>
																	<div align="right">
																		<a type="button" style ="cursor:pointer;" role="button" data-toggle="modal" data-target="#des_ShowC_modal_{{=act.id}}_{{=act.name}}" >{{=T('View more')}}</span></a>
																	</div>
															
																	<!--MODAL -->
																	<div id="des_ShowC_modal_{{=act.id}}_{{=act.name}}" class="modal hide fade" tabindex="-1" role="dialog"  aria-hidden="true"> 
																	  <div class="modal-header">
																	    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
																	      <h3 id="myModalLabel">
																	          {{=act.name}}
																	      </h3>
																	  </div>
																	  <div class="modal-body">
																	    <div class="well">
																	        <pre>
																	           {{=act.description}}
																	        </pre>
																	    </div>
																	  </div>
																	  <div class="modal-footer">
																	      <button class="btn" data-dismiss="modal" aria-hidden="true">{{=T('Close')}}</button>
																	  </div>
																	</div>
																	<!--Finish MODaL-->
																{{pass}}
															</div>
														</td>
														<td>
															{{if act.grade == float(0):}}
																<label style ="cursor:help;" title="{{=T('The grade of')}} '{{=cat.category.category}}' {{=T('is averaged.')}}">
																	{{=T('AG')}}
																</label>
															{{else:}}
																{{=act.grade}}
															{{pass}}
														</td>
														<td>{{=act.date_start}}</td>
														<td>{{=act.date_finish}}</td>
													{{pass}}
													<td>
														<center>
															{{if editable_var=='true':}}
																<a id="activityButton" role="button" class="badge btn-success"  
																onclick="updateActivity({{=act.id}},'{{=act.name}}');"> 
										                    		<span class="icon-white icon-check"></span>
										                    	</a>
									                    	{{else:}}
									                    		<a id="activityButton" role="button" class="badge btn-info"  
																onclick="editActivity({{=act.id}},'{{=act.name}}');"> 
										                    		<span class="icon-white icon-edit"></span>
										                    	</a>
									                    	{{pass}}
									                    	<a id="activityButton" role="button" class="badge btn-danger" 
									                    	onclick="removeActivity({{=act.id}},'{{=act.name}}');">
									                    		<span class="icon-white icon-remove-sign"></span>
									                    	</a>
														</center>
													</td>
												{{pass}}
												{{exist=0}}
											{{pass}}
											</tr>
										{{pass}}

										{{if totalChanges>0:}}
											{{for change in changeActivities:}}
												{{if change.operation_request=='insert':}}
													{{editable_var='false'}}
													{{if request.vars['op'] == "showEditActivity":}}
														{{if change.activity==None and request.vars['var_id']=="0" and change.name==request.vars['var_name']:}}
															{{editable_var='true'}}
														{{pass}}
													{{pass}}
													<tr>
														{{if editable_var=='true':}}
															<td>
																{{if cat.category.category=='Examen Final':}}
																	<input class="string" type="text" id="edit_activity_name1" style="width:140px;" value="Examen Final" disabled>
																{{elif change.name=='Primer Parcial' or change.name=='Segundo Parcial' or change.name=='Tercer Parcial':}}
																	<select class="generic-widget" id="edit_activity_name1" style="width:140px;">
																	{{if change.name=='Primer parcial':}}
																		<option value="{{=change.name}}">{{=change.name}}</option>
																		<option value="Segundo Parcial">Segundo Parcial</option>
																		<option value="Tercer Parcial">Tercer Parcial</option>
																	{{elif change.name=='Segundo parcial':}}
																		<option value="Primer Parcial">Primer Parcial</option>
																		<option value="{{=change.name}}">{{=change.name}}</option>
																		<option value="Tercer Parcial">Tercer Parcial</option>
																	{{else:}}
																		<option value="Primer Parcial">Primer Parcial</option>
																		<option value="Segundo Parcial">Segundo Parcial</option>
																		<option value="{{=change.name}}">{{=change.name}}</option>
																	{{pass}}
																	</select>
																{{else:}}
																	<input class="string" type="text" value="{{=change.name}}" id="edit_activity_name1" style="width:140px;">
																{{pass}}
															</td>
															<td>
																<textarea class="string" cols="40" type="text" id="edit_activity_description" style="width:200px; height:100px;">{{=change.description}}</textarea>
															</td>
															<td>
																{{if cat.specific_grade==True:}}
															    	{{if cat.category.category=='Examen Final':}}
															    		<input class="string" id="edit_field_grade" type="text" value="{{=change.grade}}" style="width:40px;" disabled>
															    	{{else:}}
															    		<input class="string" id="edit_field_grade" type="text" value="{{=change.grade}}" style="width:40px;">
															    	{{pass}}
															    {{else:}}
															    	<input class="string" id="edit_field_grade" type="text" value="{{=change.grade}}" style="width:40px;" disabled>
															    {{pass}}
															</td>
															<td>
															    <input class="date" id="edit_dateInit" name="log-date" placeholder="YYYY-MM-DD" type="text" value = "{{=change.date_start}}" style="width:100px;">
															</td>
															<td>
															    <input class="date" id="edit_dateEnd" name="log-date" placeholder="YYYY-MM-DD" type="text" value = "{{=change.date_finish}}" style="width:100px;">
															</td>
														{{else:}}
															<td><FONT COLOR="Green">{{=change.name}}</font></td>
															<td><FONT COLOR="Green">
																<div style="width:200px;">
																	{{=change.description[:100]}}
																	{{if len(change.description) > 100:}}...
																		<br>
																		<div align="right">
																			<a type="button" style ="cursor:pointer;" role="button" data-toggle="modal" data-target="#des_ShowC_modal_{{=change.id}}_{{=change.name}}" >{{=T('View more')}}</span></a>
																		</div>
																
																		<!--MODAL -->
																		<div id="des_ShowC_modal_{{=change.id}}_{{=change.name}}" class="modal hide fade" tabindex="-1" role="dialog"  aria-hidden="true"> 
																		  <div class="modal-header">
																		    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
																		      <h3 id="myModalLabel">
																		          {{=change.name}}
																		      </h3>
																		  </div>
																		  <div class="modal-body">
																		    <div class="well">
																		        <pre>
																		           {{=change.description}}
																		        </pre>
																		    </div>
																		  </div>
																		  <div class="modal-footer">
																		      <button class="btn" data-dismiss="modal" aria-hidden="true">{{=T('Close')}}</button>
																		  </div>
																		</div>
																		<!--Finish MODaL-->
																	{{pass}}
																</div>
															</font></td>
															<td><FONT COLOR="Green">
																{{if change.grade == float(0):}}
																	<label style ="cursor:help;" title="{{=T('The grade of')}} '{{=cat.category.category}}' {{=T('is averaged.')}}">
																		{{=T('AG')}}
																	</label>
																{{else:}}
																	{{=change.grade}}
																{{pass}}
															</font></td>
															<td><FONT COLOR="Green">{{=change.date_start}}</font></td>
															<td><FONT COLOR="Green">{{=change.date_finish}}</font></td>
														{{pass}}
														<td>
															<center>
																{{if editable_var=='true':}}
																	<a id="activityButton" role="button" class="badge btn-success"  
																	onclick="updateActivity(0,'{{=change.name}}');"> 
											                    		<span class="icon-white icon-check"></span>
											                    	</a>
										                    	{{else:}}
										                    		<a id="activityButton" role="button" class="badge btn-info"  
																	onclick="editActivity(0,'{{=change.name}}');"> 
											                    		<span class="icon-white icon-edit"></span>
											                    	</a>
										                    	{{pass}}
										                    	<a id="activityButton" role="button" class="badge btn-danger" 
										                    	onclick="removeActivity(0,'{{=change.name}}');"> 
										                    		<span class="icon-white icon-remove-sign"></span>
										                    	</a>
															</center>
														</td>
													</tr>
												{{pass}}
											{{pass}}
										{{pass}}
									</table>
								</div>
							</td>
						</tr>
					</table>
					<div align="right">
						<a id="addActivity" role="button" class="btn btn-warning" title="{{=T('Continue with the change request')}}" onclick="createRequestChange();"> 
					        {{=T('Continue request')}}
					        <span class="icon-arrow-right"></span>
						</a>
					</div>
				{{pass}}
			{{pass}}
		{{pass}}
	{{pass}}
{{pass}}



<script type="text/javascript">
	function showCategory(){
		category=document.getElementById('categoryID').value;
		createRequest=1;
		$("#div_request_show").empty();
		$("#div_request_show").append("{{=T('Loading')}}...");
		$("#div_request_show").load("{{=URL('activity_control','requestchangeactivity.html')}}?op=controlActivities&amp;initial=y&amp;project={{=request.vars['project']}}&amp;year={{=request.vars['year']}}&amp;category="+category);
	}


	function makeRequest(var_type){
		if (var_type==1){
			var activity_description_request_var = document.getElementById('activity_description_request').value;
			if(activity_description_request_var==""){
				alert("{{=T('Fill all fields to save.')}}");
			}else{
				createRequest=0;
				jQuery('#div_request_detail').empty();
				$("#div_request_detail").css("display", "none");
				$("#div_request_show").empty();
				$("#div_request_show").append("{{=T('Loading')}}...");
				$("#div_request_show").load("{{=URL('activity_control','requestchangeactivity.html')}}?op=createRequestChangeL&amp;create=y&amp;project={{=request.vars['project']}}&amp;year={{=request.vars['year']}}&amp;activity_description_request_var="+encodeURIComponent(activity_description_request_var)+"&amp;category="+category);
			}
		}
	}




	//*****************************************************************************************************************************************************************************************************************************************
	//*****************************************************************************************************************************************************************************************************************************************
	//*****************************************************************************************************************************************************************************************************************************************
	//*****************************************************************************************************************************************************************************************************************************************
	//Btn to continue with the request change
	function createRequestChange(){
		createRequest=1;
		$("#div_request_show").empty();
		$("#div_request_show").append("{{=T('Loading')}}...");
		$("#div_request_show").load("{{=URL('activity_control','requestchangeactivity.html')}}?op=showRequest&amp;project={{=request.vars['project']}}&amp;year={{=request.vars['year']}}&amp;category="+category);
	}
	//Btn to return to change the request
	function controlActivities(){
		$("#div_request_show").empty();
		$("#div_request_show").append("{{=T('Loading')}}...");
		$("#div_request_show").load("{{=URL('activity_control','requestchangeactivity.html')}}?op=controlActivities&amp;project={{=request.vars['project']}}&amp;year={{=request.vars['year']}}&amp;category="+category);
	}




	//*****************************************************************************************************************************************************************************************************************************************
	//*****************************************************************************************************************************************************************************************************************************************
	//*****************************************************************************************************************************************************************************************************************************************
	//*****************************************************************************************************************************************************************************************************************************************
	//Functions of edit the activities
	function removeActivity(var_id, var_name){
		var r = confirm("{{=T('Do you want to delete this record?')}}");
		if (r == true) {
			$("#div_request_show").empty();
			$("#div_request_show").append("{{=T('Loading')}}...");
			$("#div_request_show").load("{{=URL('activity_control','requestchangeactivity.html')}}?op=removeActivityL&amp;var_id="+var_id+"&amp;var_name="+encodeURIComponent(var_name)+"&amp;project={{=request.vars['project']}}&amp;year={{=request.vars['year']}}&amp;category="+category);
		}
	}

	function createActivity(){
		var activity_name1_var = document.getElementById('activity_name1').value;
	    var activity_description_var = document.getElementById('activity_description').value;
	    var field_grade_var = document.getElementById('field_grade').value;
	    var dateInit_var = document.getElementById('dateInit').value;
	    var dateEnd_var = document.getElementById('dateEnd').value;
	    if(activity_name1_var=="" || activity_description_var=="" || field_grade_var=="" || dateInit_var=="" || dateEnd_var=="" ){
	    	alert("{{=T('Fill all fields to save.')}}");
	    }else{
	    	var regex = /^\d+(?:\.\d{0,2})$/; 
			var regex2 = /^([0-9])*$/;
			if (!regex.test(field_grade_var) && !regex2.test(field_grade_var) ){
				alert("{{=T('The entered value is not a decimal')}}");
			}else{
				var formatDate = /^(\d{4})(\/|-)(\d{1,2})(\/|-)(\d{1,2})$/;
				var validDateInit = dateInit_var.match(formatDate);
				var validDateEnd = dateEnd_var.match(formatDate);
				if (validDateInit == null || validDateEnd==null) {
					alert("{{=T('Enter date and time as YYYY-MM-DD or YYYY/MM/DD')}}");
				}else{
					if(dateInit_var<=dateEnd_var){
						$("#div_request_show").empty();
						$("#div_request_show").append("{{=T('Loading')}}...");
						$("#div_request_show").load("{{=URL('activity_control','requestchangeactivity.html')}}?op=createActivity&amp;activity_name1_var=" + encodeURIComponent(activity_name1_var) + "&amp;activity_description_var=" + encodeURIComponent(activity_description_var) +"&amp;field_grade_var=" + field_grade_var + "&amp;dateInit_var="+encodeURIComponent(dateInit_var)+ "&amp;dateEnd_var="+encodeURIComponent(dateEnd_var)+"&amp;project={{=request.vars['project']}}&amp;year={{=request.vars['year']}}&amp;category="+category);
					}else{
						alert("{{=T('The end date must be greater than start date')}}");
					}
				}
			}
	    }
	}

	function editActivity(var_id, var_name){
		$("#div_request_show").load("{{=URL('activity_control','requestchangeactivity.html')}}?op=showEditActivity&amp;var_id="+var_id+"&amp;var_name="+encodeURIComponent(var_name)+"&amp;project={{=request.vars['project']}}&amp;year={{=request.vars['year']}}&amp;category="+category);
	}

	function updateActivity(var_id, var_name){
		var edit_activity_name1_var = document.getElementById('edit_activity_name1').value;
	    var edit_activity_description_var = document.getElementById('edit_activity_description').value;
	    var edit_field_grade_var = document.getElementById('edit_field_grade').value;
	    var edit_dateInit_var = document.getElementById('edit_dateInit').value;
	    var edit_dateEnd_var = document.getElementById('edit_dateEnd').value;
	    if(edit_activity_name1_var=="" || edit_activity_description_var=="" || edit_field_grade_var=="" || edit_dateInit_var=="" || edit_dateEnd_var=="" ){
	    	alert("{{=T('Fill all fields to save.')}}");
	    }else{
	    	var regex = /^\d+(?:\.\d{0,2})$/; 
			var regex2 = /^([0-9])*$/;
			if (!regex.test(edit_field_grade_var) && !regex2.test(edit_field_grade_var) ){
				alert("{{=T('The entered value is not a decimal')}}");
			}else{
				var formatDate = /^(\d{4})(\/|-)(\d{1,2})(\/|-)(\d{1,2})$/;
				var validDateInit = edit_dateInit_var.match(formatDate);
				var validDateEnd = edit_dateEnd_var.match(formatDate);
				if (validDateInit == null || validDateEnd==null) {
					alert("{{=T('Enter date and time as YYYY-MM-DD or YYYY/MM/DD')}}");
				}else{
					if(edit_dateInit_var<=edit_dateEnd_var){
						$("#div_request_show").empty();
						$("#div_request_show").append("{{=T('Loading')}}...");
						$("#div_request_show").load("{{=URL('activity_control','requestchangeactivity.html')}}?op=updateActivity&amp;var_id="+var_id+"&amp;var_name="+encodeURIComponent(var_name)+"&amp;edit_activity_name1_var=" + encodeURIComponent(edit_activity_name1_var) + "&amp;edit_activity_description_var=" + encodeURIComponent(edit_activity_description_var) +"&amp;edit_field_grade_var=" + edit_field_grade_var + "&amp;edit_dateInit_var="+encodeURIComponent(edit_dateInit_var)+ "&amp;edit_dateEnd_var="+encodeURIComponent(edit_dateEnd_var)+"&amp;project={{=request.vars['project']}}&amp;year={{=request.vars['year']}}&amp;category="+category);
					}else{
						alert("{{=T('The end date must be greater than start date')}}");
					}
				}
			}
	    }
	}

	function detail(var_id){
		$("#div_request_done").css("display", "none");
		$("#div_request_detail").css("display", "block");
		$("#div_request_detail").load("{{=URL('activity_control','requestchangeactivity.html')}}?op=solveActivityRequestDetail&amp;project={{=request.vars['project']}}&amp;year={{=request.vars['year']}}&amp;Idrequest="+var_id); 
	}

	function detailT(var_id){
		$("#div_request_done").css("display", "none");
		$("#div_request_detail").css("display", "block");
		$("#div_request_detail").load("{{=URL('activity_control','requestchangeactivity.html')}}?op=solveActivityRequestDetailO&amp;project={{=request.vars['project']}}&amp;year={{=request.vars['year']}}&amp;Idrequest="+var_id); 
	}

	function closeDetail(){
		jQuery('#div_request_detail').empty();
		$("#div_request_detail").css("display", "none");
		$("#div_request_done").css("display", "block");
	}
</script>



<!--help_modal_request_change_activity -->
<div id="help_modal_request_change_activity" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"> 
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
      <h3 id="myModalLabel">
          <span class="icon-question-sign"></span>
          {{=T('Maximum days of activity:')}}
      </h3>
  </div>
  <div class="modal-body">
    <div class="well">
        <p>
            {{=T('Maximum days for the activity is the number of days in the academic tutor for activities that fall within the category in which you are working.')}}
            <br><br>
            {{=T('For example:')}}
            <br>
            {{=T('If the category has 0 days maximum for activity, means that the day you start is the day activity must finish it.')}}
        </p>
    </div>
  </div>
  <div class="modal-footer">
      <button class="btn" data-dismiss="modal" aria-hidden="true">{{=T('Close')}}</button>
  </div>
</div>
<!--Finish help_modal_request_change_activity-->