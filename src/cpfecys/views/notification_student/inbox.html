{{extend 'template.html'}}
<table style="width:100%;" >
	<tr>
		<td style="width:90%;" >			
			<form action="" enctype="multipart/form-data" method="post" >
				<table>
					<tr>
						<td>
							<input name="_formname" type="hidden" value="select_form">
			              	<select class="generic-widget" id="semester_id" name="semester_id">
								{{for per in period_list:}}
									{{if str(per.semester.id) == str(period_id):}}
										{{var_sel="selected='selected'"}}
									{{else:}}
										{{var_sel=''}}
									{{pass}}
									<option  onclick="refresh_period({{=per.semester.id}});" value="{{=per.semester.id}}" {{=var_sel}} >{{=T(per.semester.period.name)}} {{=per.semester.yearp}}</option>
								{{pass}}
							</select>
						</td>
						<td>
              				<input type="submit" value="{{=T('go')}}" >
              			</td>
              	</table>
          	</form>
		</td>
	</tr>
	<tr>
		<td>
			<div style=" height:300px; overflow:auto;">				
				<table class="table table-striped table-bordered" >
					
					<tbody>
						{{for assignation in assignations:}}							
							<tr>
								<td >
									
										{{cont_news = 0}}
										{{mails = db((db.notification_general_log4.yearp==assignation.semester.yearp) & (db.notification_general_log4.period==assignation.semester.period.name) & (db.notification_general_log4.course==assignation.assignation.name)).select()}}
										{{for a in range(len(mails)-1, -1, -1):}}
											{{	#SHOW JUST EMAILS SENDED TO ME
												mine_var='false'
												var_query = db.notification_log4(db.notification_log4.register==mails[a].id)
												split_var1 = list(str(var_query).split("'"))
												for x in split_var1:
													split_var2 = list(str(x).split(","))
													for xx in split_var2:
														if str(xx) == str(email):
															mine_var='true'
														pass
													pass
													split_var2 = list(str(x).split("|"))
													for xx in split_var2:
														if str(xx) == str(email):
															mine_var='true'
														pass
													pass

												pass}}
											{{if mine_var=='true':}}
												{{if db((db.read_mail.id_auth_user == auth.user.id) & (db.read_mail.id_mail == mails[a].id) ).select().first() == None:}}
													{{cont_news = cont_news + 1}}
												{{pass}}
											{{pass}}
										{{pass}}
										<table class="table table-striped table-bordered" >
											<tr>
												<td width="100%">
													<span class="icon-book"></span> &nbsp 
													<a style="cursor:pointer;" onclick="click_link({{=assignation.assignation.id}});">
														{{=assignation.assignation.name}}
													</a>
												</td>
												{{if cont_news>0:}}
													<td align="right">
														<span id="information_text" class="badge btn-success">{{=T('New Mails')}} {{=cont_news}}</span> 
													</td>
												{{pass}}												
											</tr>
										</table>
									
									<div id="mail_{{=assignation.assignation.id}}" style="display:none; height:200px; overflow:auto;" >
										{{=T('Loading')}}...
									<div>
								</td>

							</tr>
						{{pass}}
					</tbody>
				</table>
			</div>
		</td>
		
	</tr>
</table>



<!--View mail Modal -->
<div id="mailModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" > 
	<div id ="a" class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
           &nbsp;   
        
    </div>
    <table class="well" style="width:100%;">
		<tr>
			<td>
				<div id="mail_div" style=" overflow:auto;">
				</div>
			</td>
		</tr>
	</table>
</div>


<script type="text/javascript">
	$(document).ready(function(){
		
  	});
  	

	function click_link(var_id){
  		$("#mail_"+var_id).toggle(700);
  		$("#mail_"+var_id).load("{{=URL('notification_student','inbox_mails_load.html')}}?operation=mails_list&amp;email={{=email}}&amp;period_id={{=period_id}}&amp;project_id="+var_id);
	}
	
</script>

